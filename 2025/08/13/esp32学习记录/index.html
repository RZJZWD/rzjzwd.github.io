<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icoa_favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"rzjzwd.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":"ture","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="&#x524D;&#x8A00;&#x4E3B;&#x8981;&#x8BB0;&#x5F55;&#x5728;&#x5B66;&#x4E60;esp32&#x4E2D;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x548C;&#x5916;&#x8BBE;&#x6A21;&#x5757;&#x9A71;&#x52A8;&#x5982;&#x4F55;&amp;#x">
<meta property="og:type" content="article">
<meta property="og:title" content="ESP32学习记录">
<meta property="og:url" content="https://rzjzwd.github.io/2025/08/13/esp32%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="RZJZWD&#39;site">
<meta property="og:description" content="&#x524D;&#x8A00;&#x4E3B;&#x8981;&#x8BB0;&#x5F55;&#x5728;&#x5B66;&#x4E60;esp32&#x4E2D;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x548C;&#x5916;&#x8BBE;&#x6A21;&#x5757;&#x9A71;&#x52A8;&#x5982;&#x4F55;&amp;#x">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-08-13T08:01:03.470Z">
<meta property="article:modified_time" content="2025-08-13T09:08:21.190Z">
<meta property="article:author" content="RZJZWD">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="ESP32">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://rzjzwd.github.io/2025/08/13/esp32%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://rzjzwd.github.io/2025/08/13/esp32%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/","path":"2025/08/13/esp32学习记录/","title":"ESP32学习记录"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ESP32学习记录 | RZJZWD'site</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">RZJZWD'site</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Welcome to my site</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E8%AE%BE"><span class="nav-number">2.</span> <span class="nav-text">外设</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LEDPWM"><span class="nav-number">2.1.</span> <span class="nav-text">LEDPWM</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.1.</span> <span class="nav-text">参数配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%88%B5%E6%9C%BA%E6%8E%A7%E5%88%B6%E5%AE%9E%E6%88%98"><span class="nav-number">2.1.2.</span> <span class="nav-text">舵机控制实战</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UART"><span class="nav-number">2.2.</span> <span class="nav-text">UART</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE"><span class="nav-number">2.2.1.</span> <span class="nav-text">参数设置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9E%E6%88%98"><span class="nav-number">2.2.2.</span> <span class="nav-text">实战</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%87%E5%86%85%E5%8A%9F%E8%83%BD"><span class="nav-number">3.</span> <span class="nav-text">片内功能</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WIFI"><span class="nav-number">3.1.</span> <span class="nav-text">WIFI</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE-1"><span class="nav-number">3.1.1.</span> <span class="nav-text">参数设置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#wifi%E4%BA%8B%E4%BB%B6"><span class="nav-number">3.1.2.</span> <span class="nav-text">wifi事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9E%E6%88%98-1"><span class="nav-number">3.1.3.</span> <span class="nav-text">实战</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AP-STA%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%91"><span class="nav-number">3.2.</span> <span class="nav-text">AP+STA模式配网</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9E%E6%88%98-2"><span class="nav-number">3.2.1.</span> <span class="nav-text">实战</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE"><span class="nav-number">4.</span> <span class="nav-text">网络协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP-Server"><span class="nav-number">4.1.</span> <span class="nav-text">HTTP_Server</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE-2"><span class="nav-number">4.1.1.</span> <span class="nav-text">参数设置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9E%E6%88%98-3"><span class="nav-number">4.1.2.</span> <span class="nav-text">实战</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">RZJZWD</p>
  <div class="site-description" itemprop="description">learn, programme, EE and life</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://rzjzwd.github.io/2025/08/13/esp32%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="RZJZWD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RZJZWD'site">
      <meta itemprop="description" content="learn, programme, EE and life">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ESP32学习记录 | RZJZWD'site">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ESP32学习记录
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-08-13 16:01:03 / 修改时间：17:08:21" itemprop="dateCreated datePublished" datetime="2025-08-13T16:01:03+08:00">2025-08-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ESP32/" itemprop="url" rel="index"><span itemprop="name">ESP32</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h3 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h3><p>&#x4E3B;&#x8981;&#x8BB0;&#x5F55;&#x5728;&#x5B66;&#x4E60;esp32&#x4E2D;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x548C;&#x5916;&#x8BBE;&#x6A21;&#x5757;&#x9A71;&#x52A8;&#x5982;&#x4F55;&#x7F16;&#x5199;<br>&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x5728;&#x9605;&#x8BFB;&#x672C;&#x6587;&#x6863;&#x524D;&#x5148;&#x6253;&#x5F00;<a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/index.html">&#x5B98;&#x65B9;&#x624B;&#x518C;</a><br>&#x5F88;&#x591A;&#x4EE3;&#x7801;&#x548C;&#x914D;&#x7F6E;&#x90FD;&#x662F;&#x53C2;&#x8003;&#x4E86;<strong>DuRuofu&#x5927;&#x4F6C;</strong>&#x7684;<a target="_blank" rel="noopener" href="https://duruofu.github.io/ESP32-Guide/docs/guide/%E7%9B%AE%E5%BD%95.html">ESP32-Guide</a>&#xFF0C;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x8865;&#x5145;&#x9605;&#x8BFB;</p>
<p><code>note</code>:&#x7B14;&#x8005;&#x5BF9;esp32&#x7684;&#x529F;&#x80FD;&#x4E5F;&#x4EC5;&#x4EC5;&#x662F;&#x5904;&#x5728;&#x4F1A;&#x8C03;&#x7528;api&#x800C;&#x5DF2;&#xFF0C;&#x5B9E;&#x529B;&#x6709;&#x9650;&#x3002;&#x5BF9;&#x4E8E;&#x672C;&#x6587;&#x4E2D;&#x51FA;&#x73B0;&#x7684;&#x9519;&#x8BEF;&#x8FD8;&#x8BF7;&#x89C1;&#x8C05;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x4EA4;&#x6D41;&#x53EF;&#x4EE5;&#x53D1;&#x90AE;&#x4EF6;(<a href="mailto:rzjzwd@outlook.com">rzjzwd@outlook.com</a>)&#x6216;&#x8005;&#x8BC4;&#x8BBA;&#x533A;&#x7559;&#x8A00;&#xFF08;&#x53EF;&#x80FD;&#x6CA1;&#x6709;&#x8BC4;&#x8BBA;&#x533A;&#xFF09;</p>
<span id="more"></span>
<h3 id="&#x5916;&#x8BBE;"><a href="#&#x5916;&#x8BBE;" class="headerlink" title="&#x5916;&#x8BBE;"></a>&#x5916;&#x8BBE;</h3><h4 id="LEDPWM"><a href="#LEDPWM" class="headerlink" title="LEDPWM"></a>LEDPWM</h4><p>&#x8FD9;&#x4E2A;&#x5916;&#x8BBE;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x63A7;&#x5236;LED&#x547C;&#x5438;&#x706F;&#xFF0C;&#x4F46;&#x662F;&#x672C;&#x6587;&#x6863;&#x4E2D;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x5BF9;&#x8235;&#x673A;&#x8FDB;&#x884C;&#x7B80;&#x5355;&#x7684;&#x63A7;&#x5236;<br>&#x76F8;&#x5173;&#x7684;&#x51FD;&#x6570;&#x5728;<code>&quot;driver/ledc.h&quot;</code>&#x4E2D;</p>
<h5 id="&#x53C2;&#x6570;&#x914D;&#x7F6E;"><a href="#&#x53C2;&#x6570;&#x914D;&#x7F6E;" class="headerlink" title="&#x53C2;&#x6570;&#x914D;&#x7F6E;"></a>&#x53C2;&#x6570;&#x914D;&#x7F6E;</h5><ol>
<li>&#x521D;&#x59CB;&#x5316;&#x5B9A;&#x65F6;&#x5668;<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ledc_timer_config_t</span> timerCig = {</span><br><span class="line">    .speed_mode = LEDC_LOW_SPEED_MODE,      <span class="comment">//&#x8BBE;&#x7F6E;&#x901F;&#x5EA6;</span></span><br><span class="line">    .duty_resolution = LEDC_TIMER_13_BIT,   <span class="comment">//&#x7CBE;&#x5EA6;</span></span><br><span class="line">    .timer_num = LEDC_TIMER_0,              <span class="comment">//&#x5B9A;&#x65F6;&#x5668;0</span></span><br><span class="line">    .freq_hz = <span class="number">50</span>,                          <span class="comment">//&#x9891;&#x7387;50hz</span></span><br><span class="line">    .clk_cfg = LEDC_AUTO_CLK                <span class="comment">//&#x65F6;&#x949F;&#x6E90;&#x8BBE;&#x7F6E;</span></span><br><span class="line">};</span><br><span class="line">ledc_timer_config(&amp;timerCig);          <span class="comment">//&#x8BBE;&#x7F6E;</span></span><br></pre></td></tr></table></figure></li>
<li>&#x914D;&#x7F6E;&#x901A;&#x9053;<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ledc_channel_config_t</span> channelCfg = {            </span><br><span class="line">            .gpio_num = gpioPin,                <span class="comment">//gpio&#x53E3;</span></span><br><span class="line">            .speed_mode = LEDC_LOW_SPEED_MODE,  <span class="comment">//&#x901F;&#x5EA6;</span></span><br><span class="line">            <span class="comment">//&#x901A;&#x9053;&#x8BBE;&#x7F6E;&#xFF0C;&#x4E00;&#x4E2A;&#x5B9A;&#x65F6;&#x5668;&#x6709;&#x516B;&#x4E2A;&#x9AD8;&#x901F;&#x901A;&#x9053;&#x548C;&#x516B;&#x4E2A;&#x4F4E;&#x901F;&#x901A;&#x9053;</span></span><br><span class="line">            .channel = i,                       </span><br><span class="line">            .timer_sel = LEDC_TIMER_0,          <span class="comment">//&#x8BBE;&#x7F6E;&#x5B9A;&#x65F6;&#x5668;</span></span><br><span class="line">            .duty = <span class="number">0</span></span><br><span class="line">        };</span><br><span class="line">ledc_channel_config(&amp;channelCfg);       <span class="comment">//&#x8BBE;&#x7F6E;</span></span><br></pre></td></tr></table></figure></li>
<li>&#x8BBE;&#x7F6E;&#x5360;&#x7A7A;&#x6BD4;&#x51FD;&#x6570;<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ledc_set_duty(LEDC_LOW_SPEED_MODE, ch, duty);</span><br><span class="line">ledc_update_duty(LEDC_LOW_SPEED_MODE, ch);</span><br></pre></td></tr></table></figure>
<code>ch</code>&#x662F;&#x901A;&#x9053;&#xFF0C;&#x6BCF;&#x4E2A;&#x901A;&#x9053;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;pwm&#x8F93;&#x51FA;io,<code>duty</code>&#x5C31;&#x662F;&#x5360;&#x7A7A;&#x6BD4;</li>
</ol>
<h5 id="&#x8235;&#x673A;&#x63A7;&#x5236;&#x5B9E;&#x6218;"><a href="#&#x8235;&#x673A;&#x63A7;&#x5236;&#x5B9E;&#x6218;" class="headerlink" title="&#x8235;&#x673A;&#x63A7;&#x5236;&#x5B9E;&#x6218;"></a>&#x8235;&#x673A;&#x63A7;&#x5236;&#x5B9E;&#x6218;</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//servo_driver.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _SERVO_DRIVER_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _SERVO_DRIVER_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SERVO_NUMS (8)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> {</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>{</span></span><br><span class="line">    <span class="type">uint8_t</span> gpioPin; </span><br><span class="line">    <span class="type">float</span> minAngleDeg;        </span><br><span class="line">    <span class="type">float</span> maxAngleDeg;        </span><br><span class="line">    <span class="type">uint16_t</span> minPulseOfUs;</span><br><span class="line">    <span class="type">uint16_t</span> maxPulseOfUs;</span><br><span class="line">} servoConfig_t;</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x9519;&#x8BEF;&#x7801;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> {</span></span><br><span class="line">    SERVO_OK = <span class="number">0</span>,</span><br><span class="line">    SERVO_ERR_INVALID_ID,   <span class="comment">//&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x8235;&#x673A;&#x53F7;</span></span><br><span class="line">    SERVO_ERR_ANGLE_OUT_OF_RANGE    <span class="comment">//&#x89D2;&#x5EA6;&#x8D85;&#x8FC7;&#x9608;&#x503C;</span></span><br><span class="line">} servoErrorCode_t;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief &#x521D;&#x59CB;&#x5316;&#x8235;&#x673A;</span></span><br><span class="line"><span class="comment"> * @param servoConfig &#x8235;&#x673A;&#x53C2;&#x6570;</span></span><br><span class="line"><span class="comment"> * @param servoNums &#x8235;&#x673A;&#x6570;&#x91CF;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">servo_init</span><span class="params">(<span class="type">const</span> servoConfig_t *Config, <span class="type">uint8_t</span> servoNums)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief &#x8BBE;&#x7F6E;&#x5355;&#x4E2A;&#x8235;&#x673A;&#x89D2;&#x5EA6;</span></span><br><span class="line"><span class="comment"> * @param servoId &#x8235;&#x673A;&#x53F7;</span></span><br><span class="line"><span class="comment"> * @param angleDeg &#x89D2;&#x5EA6;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">servo_set_angle</span><span class="params">(<span class="type">uint8_t</span> servoId, <span class="type">float</span> angleDeg)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief &#x6279;&#x91CF;&#x8BBE;&#x7F6E;&#x8235;&#x673A;&#x89D2;&#x5EA6;</span></span><br><span class="line"><span class="comment"> * @param angles &#x89D2;&#x5EA6;</span></span><br><span class="line"><span class="comment"> * @param servoNums &#x8235;&#x673A;&#x6570;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">servo_set_all_angles</span><span class="params">(<span class="type">const</span> <span class="type">float</span>* angles, <span class="type">uint8_t</span> servoNums)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//servo_driver.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;servo_driver.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;driver/ledc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_log.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TAG <span class="string">&quot;SERVO_DRIVE&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">    <span class="type">const</span> servoConfig_t *servoConfigs;</span><br><span class="line">    <span class="type">uint8_t</span> servoNums;</span><br><span class="line">    <span class="type">ledc_channel_config_t</span> *servoChannels;</span><br><span class="line">} servoDriverCtx_t;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> servoDriverCtx_t servoDriverCtx;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief &#x89D2;&#x5EA6;&#x8F6C;&#x5360;&#x7A7A;&#x6BD4;</span></span><br><span class="line"><span class="comment"> * @param servoId &#x8235;&#x673A;&#x53F7;</span></span><br><span class="line"><span class="comment"> * @param angleDeg &#x89D2;&#x5EA6;</span></span><br><span class="line"><span class="comment"> * @return &#x5360;&#x7A7A;&#x6BD4;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">angle2duty</span><span class="params">(<span class="type">uint8_t</span> servoId, <span class="type">float</span> angleDeg)</span>{</span><br><span class="line">    <span class="comment">//&#x53D6;&#x8235;&#x673A;&#x53F7;&#x5BF9;&#x5E94;&#x53C2;&#x6570;&#x7684;&#x6307;&#x9488;&#x7ED9;a2dConfig</span></span><br><span class="line">    <span class="type">const</span> servoConfig_t *a2dConfig = &amp;servoDriverCtx.servoConfigs[servoId];</span><br><span class="line">    <span class="comment">//&#x89D2;&#x5EA6;&#x9650;&#x5236;</span></span><br><span class="line">    <span class="keyword">if</span>(angleDeg &lt; a2dConfig-&gt;minAngleDeg){</span><br><span class="line">        angleDeg = a2dConfig-&gt;minAngleDeg;</span><br><span class="line">    }<span class="keyword">else</span> <span class="keyword">if</span>(angleDeg &gt;a2dConfig-&gt;maxAngleDeg){</span><br><span class="line">        angleDeg = a2dConfig-&gt;maxAngleDeg;</span><br><span class="line">    }<span class="keyword">else</span></span><br><span class="line">        angleDeg = angleDeg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x8BA1;&#x7B97;&#x8109;&#x51B2;</span></span><br><span class="line">    <span class="type">float</span> pluseOfUs = a2dConfig-&gt;minPulseOfUs +</span><br><span class="line">                      (angleDeg - a2dConfig-&gt;minAngleDeg) *</span><br><span class="line">                          (a2dConfig-&gt;maxPulseOfUs - a2dConfig-&gt;minPulseOfUs) /</span><br><span class="line">                          (a2dConfig-&gt;maxAngleDeg - a2dConfig-&gt;minAngleDeg);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//pluseOfUs * 1e-6,&#x628A;us&#x8F6C;&#x6362;&#x4E3A;s</span></span><br><span class="line">    <span class="comment">//&#x5B9A;&#x65F6;&#x5668;&#x603B;&#x8BA1;&#x6570;&#x503C;(2^13) * &#x4FE1;&#x53F7;&#x9891;&#x7387;&#xFF08;50hz&#xFF09;</span></span><br><span class="line">    <span class="comment">//&#x4EE5;&#x4E0A;&#x4E24;&#x4E2A;&#x76F8;&#x4E58;&#x5F97;&#x5360;&#x7A7A;&#x6BD4;</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="type">uint32_t</span>)((pluseOfUs * <span class="number">1e-6</span>) * ((<span class="number">1</span> &lt;&lt; LEDC_TIMER_13_BIT) - <span class="number">1</span>) * <span class="number">50</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">servo_init</span> <span class="params">(<span class="type">const</span> servoConfig_t *Config, <span class="type">uint8_t</span> servoNums)</span>{</span><br><span class="line">    servoDriverCtx.servoConfigs = Config;</span><br><span class="line">    servoDriverCtx.servoNums = servoNums;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x521D;&#x59CB;&#x5316;LEDC&#x5B9A;&#x65F6;&#x5668;</span></span><br><span class="line">    <span class="type">ledc_timer_config_t</span> servoTimerCig = {</span><br><span class="line">        .speed_mode = LEDC_LOW_SPEED_MODE,</span><br><span class="line">        .duty_resolution = LEDC_TIMER_13_BIT,</span><br><span class="line">        .timer_num = LEDC_TIMER_0,</span><br><span class="line">        .freq_hz = <span class="number">50</span>,</span><br><span class="line">        .clk_cfg = LEDC_AUTO_CLK</span><br><span class="line">    };</span><br><span class="line">    ledc_timer_config(&amp;servoTimerCig);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x914D;&#x7F6E;&#x901A;&#x9053;</span></span><br><span class="line">    servoDriverCtx.servoChannels = <span class="built_in">malloc</span>(servoNums * <span class="keyword">sizeof</span>(<span class="type">ledc_channel_config_t</span>));    <span class="comment">//&#x6309;&#x8235;&#x673A;&#x6570;&#x91CF;&#xFF0C;&#x901A;&#x9053;&#x7ED3;&#x6784;&#x4F53;&#x5927;&#x5C0F;&#x7533;&#x8BF7;&#x5185;&#x5B58;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; servoNums; i++){</span><br><span class="line">        <span class="comment">//&#x6309;&#x6570;&#x7EC4;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;&#x5199;&#x5165;</span></span><br><span class="line">        servoDriverCtx.servoChannels[i] = (<span class="type">ledc_channel_config_t</span>){</span><br><span class="line">            .gpio_num = Config[i].gpioPin,</span><br><span class="line">            .speed_mode = LEDC_LOW_SPEED_MODE,</span><br><span class="line">            .channel = i,</span><br><span class="line">            .timer_sel = LEDC_TIMER_0,</span><br><span class="line">            .duty = <span class="number">0</span></span><br><span class="line">        };</span><br><span class="line">        ledc_channel_config(&amp;servoDriverCtx.servoChannels[i]);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">servo_set_angle</span> <span class="params">(<span class="type">uint8_t</span> servoId, <span class="type">float</span> angleDeg)</span>{</span><br><span class="line">    <span class="type">static</span> servoErrorCode_t servoErrorCode;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//&#x68C0;&#x67E5;&#x8235;&#x673A;&#x53F7;&#x5408;&#x6CD5;&#x6027;</span></span><br><span class="line">    <span class="keyword">if</span>(servoId &gt;=servoDriverCtx.servoNums){</span><br><span class="line">        ESP_LOGE(TAG, <span class="string">&quot;Invalid servo ID: %d&quot;</span>, servoId);</span><br><span class="line">        servoErrorCode = SERVO_ERR_INVALID_ID;</span><br><span class="line">        <span class="keyword">return</span> servoErrorCode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x68C0;&#x67E5;&#x89D2;&#x5EA6;&#x5408;&#x6CD5;&#x6027;</span></span><br><span class="line">    <span class="type">const</span> servoConfig_t *Config = &amp;servoDriverCtx.servoConfigs[servoId];</span><br><span class="line">    <span class="keyword">if</span>(angleDeg &lt; Config-&gt;minAngleDeg || angleDeg &gt; Config-&gt;maxAngleDeg){</span><br><span class="line">        ESP_LOGE(TAG, <span class="string">&quot;Servo %d angle %.1f out of range [%.1f, %.1f]&quot;</span>,</span><br><span class="line">                 servoId, angleDeg, Config-&gt;minAngleDeg, Config-&gt;maxAngleDeg);</span><br><span class="line">        servoErrorCode = SERVO_ERR_ANGLE_OUT_OF_RANGE;</span><br><span class="line">        <span class="keyword">return</span> servoErrorCode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> duty = angle2duty(servoId, angleDeg);</span><br><span class="line">    ledc_set_duty(LEDC_LOW_SPEED_MODE, servoId, duty);</span><br><span class="line">    ledc_update_duty(LEDC_LOW_SPEED_MODE, servoId);</span><br><span class="line">    servoErrorCode = SERVO_OK;</span><br><span class="line">    <span class="keyword">return</span> servoErrorCode;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">servo_set_all_angles</span><span class="params">(<span class="type">const</span> <span class="type">float</span>* angles, <span class="type">uint8_t</span> servoNums)</span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; servoNums; i++){</span><br><span class="line">        servo_set_angle(i, angles[i]);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5B9E;&#x9645;&#x5E94;&#x7528;&#xFF0C;&#x4EE5;&#x540C;&#x65F6;&#x63A7;&#x5236;&#x516B;&#x4E2A;&#x8235;&#x673A;&#x4E3A;&#x4F8B;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x6570;&#x7EC4;&#x7ED3;&#x6784;&#x4F53;&#x6210;&#x5458;&#xFF0C;gpio&#xFF0C;&#x6700;&#x5C0F;&#x89D2;&#x5EA6;&#xFF0C;&#x6700;&#x5927;&#x89D2;&#x5EA6;&#xFF0C;&#x6700;&#x5C0F;&#x8109;&#x51B2;&#xFF0C;&#x6700;&#x5927;&#x8109;&#x51B2;</span></span><br><span class="line">servoConfig_t servoConfigse[SERVO_NUMS] = {</span><br><span class="line">    {<span class="number">18</span>, <span class="number">0</span>, <span class="number">90</span>, <span class="number">500</span>, <span class="number">2500</span>},</span><br><span class="line">    {<span class="number">19</span>, <span class="number">0</span>, <span class="number">180</span>, <span class="number">500</span>, <span class="number">2500</span>},</span><br><span class="line">    {<span class="number">16</span>, <span class="number">90</span>, <span class="number">180</span>, <span class="number">500</span>, <span class="number">2500</span>},</span><br><span class="line">    {<span class="number">17</span>, <span class="number">0</span>, <span class="number">180</span>, <span class="number">500</span>, <span class="number">2500</span>},</span><br><span class="line">    {<span class="number">26</span>, <span class="number">0</span>, <span class="number">90</span>, <span class="number">500</span>, <span class="number">2500</span>},</span><br><span class="line">    {<span class="number">27</span>, <span class="number">0</span>, <span class="number">180</span>, <span class="number">500</span>, <span class="number">2500</span>},</span><br><span class="line">    {<span class="number">33</span>, <span class="number">90</span>, <span class="number">180</span>, <span class="number">500</span>, <span class="number">2500</span>},</span><br><span class="line">    {<span class="number">32</span>, <span class="number">0</span>, <span class="number">180</span>, <span class="number">500</span>, <span class="number">2500</span>},</span><br><span class="line">};</span><br><span class="line">servo_init(servoConfigse, SERVO_NUMS);</span><br></pre></td></tr></table></figure>

<h4 id="UART"><a href="#UART" class="headerlink" title="UART"></a>UART</h4><p> esp32&#x4E2D;&#x7684;&#x4E32;&#x53E3;&#x6709;&#x4E09;&#x4E2A;&#xFF0C;UART0&#x662F;&#x4F5C;&#x4E3A;&#x4E0B;&#x8F7D;&#xFF0C;&#x8C03;&#x8BD5;&#x4E32;&#x53E3;&#x4F7F;&#x7528;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x6B21;&#x7528;&#x7684;&#x662F;&#x4E32;&#x53E3;2&#x3002;<br>&#x76F8;&#x5173;&#x914D;&#x7F6E;&#x51FD;&#x6570;ESP&#x5B98;&#x65B9;&#x5DF2;&#x7ECF;&#x63D0;&#x4F9B;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x6587;&#x4EF6;&#x5F53;&#x4E2D;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;driver/uart.h&quot;</span></span></span><br></pre></td></tr></table></figure>
<hr>
<h5 id="&#x53C2;&#x6570;&#x8BBE;&#x7F6E;"><a href="#&#x53C2;&#x6570;&#x8BBE;&#x7F6E;" class="headerlink" title="&#x53C2;&#x6570;&#x8BBE;&#x7F6E;"></a>&#x53C2;&#x6570;&#x8BBE;&#x7F6E;</h5><p>&#x9A71;&#x52A8;&#x5206;&#x4E3A;&#x4E09;&#x6B65;</p>
<ol>
<li>UART&#x9A71;&#x52A8;&#x6CE8;&#x518C;<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">uart_driver_install(<span class="type">uart_port_t</span> uart_num,   <span class="comment">//&#x4E32;&#x53E3;&#x53F7;</span></span><br><span class="line">                    <span class="type">int</span> rx_buffer_size,     <span class="comment">//&#x63A5;&#x6536;&#x7AEF;&#x7F13;&#x51B2;&#x533A;</span></span><br><span class="line">                    <span class="type">int</span> tx_buffer_size,     <span class="comment">//&#x53D1;&#x9001;&#x7AEF;&#x7F13;&#x51B2;&#x533A;</span></span><br><span class="line">                    <span class="type">int</span> event_queue_size,   <span class="comment">//&#x961F;&#x5217;&#x5927;&#x5C0F;&#xFF0C;&#x6CA1;&#x6709;&#x5199;0</span></span><br><span class="line">                    QueueHandle_t *uart_queue, <span class="comment">//&#x961F;&#x5217;&#x53E5;&#x67C4;&#xFF0C;&#x6CA1;&#x6709;&#x5199;NULL</span></span><br><span class="line">                    <span class="type">int</span> intr_alloc_flags    <span class="comment">//&#x4E2D;&#x65AD;&#x6807;&#x5FD7;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5C31;0</span></span><br><span class="line">                    )   </span><br></pre></td></tr></table></figure>
&#x793A;&#x4F8B;&#xFF1A;<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uart_driver_install(<span class="number">2</span>, <span class="number">1024</span>*<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure></li>
<li>UART&#x53C2;&#x6570;&#x8BBE;&#x7F6E;<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uart_param_config(<span class="type">uart_port_t</span> uart_num,         <span class="comment">//&#x4E32;&#x53E3;&#x53F7;</span></span><br><span class="line">                <span class="type">const</span> <span class="type">uart_config_t</span> *uart_config<span class="comment">//&#x53C2;&#x6570;&#x7ED3;&#x6784;&#x4F53;&#x6307;&#x9488;</span></span><br><span class="line">                )</span><br></pre></td></tr></table></figure></li>
</ol>
<p>&#x53C2;&#x6570;&#x7ED3;&#x6784;&#x4F53;&#xFF1A;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uart_config_t</span> uartConfig = {</span><br><span class="line">    .baud_rate = <span class="number">115200</span>,                    <span class="comment">//&#x6CE2;&#x7279;&#x7387;</span></span><br><span class="line">    .data_bits = UART_DATA_8_BITS,          <span class="comment">//&#x516B;&#x4F4D;&#x6570;&#x636E;&#x4F4D;</span></span><br><span class="line">    .parity = UART_PARITY_DISABLE,          <span class="comment">//&#x6821;&#x9A8C;&#x4F4D;</span></span><br><span class="line">    .stop_bits = UART_STOP_BITS_1,          <span class="comment">//&#x505C;&#x6B62;&#x4F4D;</span></span><br><span class="line">    .flow_ctrl = UART_HW_FLOWCTRL_DISABLE   <span class="comment">//&#x786C;&#x4EF6;&#x6D41;&#x63A7;&#x5236;</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>UART&#x5F15;&#x811A;&#x8BBE;&#x7F6E;<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">uart_set_pin(<span class="type">uart_port_t</span> uart_num,      <span class="comment">//&#x4E32;&#x53E3;&#x53F7;</span></span><br><span class="line">            <span class="type">int</span> tx_io_num,              <span class="comment">//tx&#x5F15;&#x811A;&#xFF08;17&#xFF09;</span></span><br><span class="line">            <span class="type">int</span> rx_io_num,              <span class="comment">//rx&#x5F15;&#x811A;&#xFF08;16&#xFF09;</span></span><br><span class="line">            <span class="type">int</span> rts_io_num,             <span class="comment">//rts&#x5F15;&#x811A; &#x786C;&#x4EF6;&#x6D41;&#x63A7;&#x811A;</span></span><br><span class="line">            <span class="type">int</span> cts_io_num              <span class="comment">//cts&#x5F15;&#x811A; &#x786C;&#x4EF6;&#x6D41;&#x63A7;&#x811A;</span></span><br><span class="line">            )</span><br></pre></td></tr></table></figure>
&#x793A;&#x4F8B;:<br>&#x5982;&#x679C;&#x4E0D;&#x542F;&#x7528;&#x786C;&#x4EF6;&#x6D41;&#x63A7;&#xFF0C;<code>rts</code> <code>cts</code>&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x4F20;&#x5165;<code>UART_PIN_NO_CHANGE</code><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uart_set_pin(<span class="number">2</span>, <span class="number">17</span>, <span class="number">16</span>, UART_PIN_NO_CHANGE, UART_PIN_NO_CHANGE)</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h5 id="&#x5B9E;&#x6218;"><a href="#&#x5B9E;&#x6218;" class="headerlink" title="&#x5B9E;&#x6218;"></a>&#x5B9E;&#x6218;</h5><ol>
<li>&#x521B;&#x5EFA;&#x7EC4;&#x4EF6;<br>&#x8FD9;&#x91CC;&#x91C7;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7EC4;&#x4EF6;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5728;<strong>ESP_IDF</strong>&#x4E2D;&#x4F7F;&#x7528;&#x547D;&#x4EE4;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">idf.py -C components create-component uart_driver</span><br></pre></td></tr></table></figure>
<code>uart_driver</code>&#x90E8;&#x5206;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x540D;&#x79F0;</li>
</ol>
<p>&#x5728;<code>components/uart_driver</code>&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x7684;<code>.c</code> <code>.h</code>&#x6587;&#x4EF6;</p>
<ol start="2">
<li><p>&#x5F15;&#x5165;<code>&quot;driver/uart.h&quot;</code>&#x53CA;&#x4FEE;&#x6539;<code>CMakeLists.txt</code>&#x6587;&#x4EF6;<br><code>components/uart_driver/CMakeLists.txt</code>&#xFF0C;&#x6253;&#x5F00;&#x8FD9;&#x4E2A;txt&#x6587;&#x4EF6;,&#x5199;&#x5165;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">idf_component_register(SRCS <span class="string">&quot;uart_driver.c&quot;</span></span><br><span class="line">                    INCLUDE_DIRS <span class="string">&quot;include&quot;</span></span><br><span class="line">                    REQUIRES <span class="string">&quot;driver&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><code>REQUIRES &quot;driver&quot;</code>&#x90E8;&#x5206;&#x5C31;&#x662F;&#x5728;&#x544A;&#x8BC9;cmake&#x5305;&#x542B;&#x4E86;driver&#x6587;&#x4EF6;&#x5939;&#x7684;&#x5185;&#x5BB9;&#xFF08;&#x6211;&#x731C;&#x7684;&#xFF09;</p>
</li>
<li><p>&#x521D;&#x59CB;&#x5316;&#x51FD;&#x6570;<br>&#x4EE5;&#x4E0B;&#x7684;&#x5185;&#x5BB9;&#x53EA;&#x662F;&#x6458;&#x53D6;&#x4E86;&#x6587;&#x4EF6;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#xFF0C;&#x5177;&#x4F53;&#x60C5;&#x51B5;&#x6309;&#x6240;&#x9700;&#x914D;&#x7F6E;</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//uart_driver.h</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    <span class="type">int</span> bandRate;   <span class="comment">//&#x6CE2;&#x7279;&#x7387;</span></span><br><span class="line">    <span class="type">int</span> uartNum;    <span class="comment">//&#x4E32;&#x53E3;&#x53F7;</span></span><br><span class="line">    <span class="type">int</span> txPin;</span><br><span class="line">    <span class="type">int</span> rxPin;</span><br><span class="line"></span><br><span class="line">}uartPin_t;         <span class="comment">//&#x8FD9;&#x91CC;&#x6211;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x7BA1;&#x7406;&#x81EA;&#x5B9A;&#x4E49;&#x6570;&#x636E;&#xFF0C;</span></span><br><span class="line">                    <span class="comment">//&#x5176;&#x4ED6;&#x53C2;&#x6570;&#x4E00;&#x822C;&#x4E0D;&#x7528;&#x6539;&#x53D8;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief &#x521D;&#x59CB;&#x5316;&#x4E32;&#x53E3;</span></span><br><span class="line"><span class="comment"> * @param uartInitConfig &#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x6CE2;&#x7279;&#x7387;&#xFF0C;&#x4E32;&#x53E3;&#x53F7;&#xFF0C;tx&#xFF0C;rx&#x5F15;&#x811A;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">uart_Init</span><span class="params">(uartPin_t *uartInitConfig)</span>;</span><br></pre></td></tr></table></figure>
<p>&#x51FD;&#x6570;&#x5B9E;&#x73B0;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//uart_driver.c</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> uartBufferSize = (<span class="number">1024</span> * <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">uart_Init</span><span class="params">(uartPin_t *uartInitConfig)</span>{</span><br><span class="line">    uartPin_t *uartInitPin = uartInitConfig;</span><br><span class="line">    <span class="type">uart_config_t</span> uartConfig = {</span><br><span class="line">        .baud_rate = uartInitPin-&gt;bandRate,</span><br><span class="line">        .data_bits = UART_DATA_8_BITS,</span><br><span class="line">        .parity = UART_PARITY_DISABLE,</span><br><span class="line">        .stop_bits = UART_STOP_BITS_1,</span><br><span class="line">        .flow_ctrl = UART_HW_FLOWCTRL_DISABLE</span><br><span class="line">    };</span><br><span class="line">    ESP_ERROR_CHECK(uart_driver_install(uartInitPin-&gt;uartNum, uartBufferSize, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>));</span><br><span class="line">    ESP_ERROR_CHECK(uart_param_config(uartInitPin-&gt;uartNum, &amp;uartConfig));</span><br><span class="line">    ESP_ERROR_CHECK(uart_set_pin(uartInitPin-&gt;uartNum, uartInitPin-&gt;txPin, uartInitPin-&gt;rxPin, UART_PIN_NO_CHANGE, UART_PIN_NO_CHANGE));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>ESP_ERROR_CHECK()</code>&#x51FD;&#x6570;&#x8981;&#x5305;&#x542B;<code>#include &quot;esp_err.h&quot;</code>&#xFF0C;&#x7528;&#x4E8E;&#x68C0;&#x67E5;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x51FA;&#x9519;&#x7A0B;&#x5E8F;&#x4F1A;&#x76F4;&#x63A5;&#x505C;&#x6B62;</p>
<ol start="4">
<li>&#x6D4B;&#x8BD5;&#x51FD;&#x6570;<br>&#x4E3B;&#x673A;&#x53D1;&#x4EC0;&#x4E48;&#xFF0C;esp&#x518D;&#x53D1;&#x56DE;&#x6765;<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">uart_send_recive_test</span><span class="params">(<span class="type">void</span> *pvParameters)</span>{</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *testLen = <span class="string">&quot;Please send massage\n&quot;</span>;</span><br><span class="line">    <span class="type">uint8_t</span> rxData[<span class="number">10</span>];                             <span class="comment">//&#x63A5;&#x6536;&#x6570;&#x7EC4;&#x5927;&#x5C0F;</span></span><br><span class="line">    uart_write_bytes(<span class="number">2</span>, testLen, <span class="built_in">strlen</span>(testLen));</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>){</span><br><span class="line">        <span class="type">int</span> length = <span class="number">0</span>;</span><br><span class="line">        ESP_ERROR_CHECK(uart_get_buffered_data_len(<span class="number">2</span>, (<span class="type">size_t</span>*)&amp;length));</span><br><span class="line">        <span class="keyword">if</span>(length &gt; <span class="number">0</span>){</span><br><span class="line">            <span class="type">int</span> readLength = uart_read_bytes(<span class="number">2</span>, &amp;rxData, length, pdMS_TO_TICKS(<span class="number">100</span>));</span><br><span class="line">            <span class="keyword">if</span>(readLength &gt; <span class="number">0</span>){</span><br><span class="line">                uart_write_bytes(<span class="number">2</span>, rxData, <span class="number">10</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        vTaskDelay(<span class="number">10</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="&#x7247;&#x5185;&#x529F;&#x80FD;"><a href="#&#x7247;&#x5185;&#x529F;&#x80FD;" class="headerlink" title="&#x7247;&#x5185;&#x529F;&#x80FD;"></a>&#x7247;&#x5185;&#x529F;&#x80FD;</h3><h4 id="WIFI"><a href="#WIFI" class="headerlink" title="WIFI"></a>WIFI</h4><p>&#x8FD9;&#x8282;&#x53EA;&#x4ECB;&#x7ECD;WiFi&#x914D;&#x7F6E;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x4F7F;&#x7528;WiFi&#x914D;&#x7F51;&#xFF0C;&#x8BF7;&#x8F6C;&#x5230;<a href="#section%E9%85%8D%E7%BD%91">&#x914D;&#x7F51;&#x7684;&#x7AE0;&#x8282;</a></p>
<h5 id="&#x53C2;&#x6570;&#x8BBE;&#x7F6E;-1"><a href="#&#x53C2;&#x6570;&#x8BBE;&#x7F6E;-1" class="headerlink" title="&#x53C2;&#x6570;&#x8BBE;&#x7F6E;"></a>&#x53C2;&#x6570;&#x8BBE;&#x7F6E;</h5><ol>
<li>&#x521D;&#x59CB;&#x5316;TCP/IP&#x534F;&#x8BAE;&#x6808;<br><code>ESP_ERROR_CHECK(esp_netif_init());</code><br><code>ESP_ERROR_CHECK</code>&#x7528;&#x4E8E;&#x68C0;&#x67E5;</li>
<li>&#x914D;&#x7F6E;WIFI&#x53C2;&#x6570;<br>&#x6A21;&#x5F0F;&#x53C2;&#x6570;<br><code>esp_netif_create_default_wifi_sta();</code>&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;sta&#x6A21;&#x5F0F;&#x7684;&#x9ED8;&#x8BA4;&#x53C2;&#x6570;<br>&#x53C2;&#x6570;&#x914D;&#x7F6E;:&#x9ED8;&#x8BA4;&#x53C2;&#x6570;<br><code>wifi_init_config_t cfg = WIFI_INIT_CONFIG_DEFAULT();</code><br><code>wifi_init_config_t</code>&#x7ED3;&#x6784;&#x4F53;&#x7C7B;&#x578B;<br><code>WIFI_INIT_CONFIG_DEFAULT()</code>&#x8FD4;&#x56DE;&#x9ED8;&#x8BA4;&#x53C2;&#x6570;<br>&#x53C2;&#x6570;&#x914D;&#x7F6E;&#xFF1A;&#x81EA;&#x5B9A;&#x4E49;&#x53C2;&#x6570;<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">wifi_config_t</span> wifi_config = {</span><br><span class="line">        .sta = {</span><br><span class="line">            .ssid = <span class="string">&quot;yourssid&quot;</span>,</span><br><span class="line">            .password = <span class="string">&quot;yourpassword&quot;</span>,</span><br><span class="line">        },</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li>
<li>&#x8BBE;&#x7F6E;&#x53C2;&#x6570;<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ESP_ERROR_CHECK(esp_wifi_set_mode(WIFI_MODE_STA));<span class="comment">//&#x8BBE;&#x7F6E;sta&#x6A21;&#x5F0F;</span></span><br><span class="line"><span class="comment">//&#x8BBE;&#x7F6E;&#x53C2;&#x6570;</span></span><br><span class="line">ESP_ERROR_CHECK(esp_wifi_set_config(ESP_IF_WIFI_STA, wifi_config));</span><br></pre></td></tr></table></figure></li>
<li>wifi_&#x542F;&#x52A8;<br><code>ESP_ERROR_CHECK(esp_wifi_start());</code></li>
</ol>
<h5 id="wifi&#x4E8B;&#x4EF6;"><a href="#wifi&#x4E8B;&#x4EF6;" class="headerlink" title="wifi&#x4E8B;&#x4EF6;"></a>wifi&#x4E8B;&#x4EF6;</h5><ol>
<li>&#x8BBE;&#x7F6E;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;<br><code>ESP_ERROR_CHECK(esp_event_loop_create_default());</code></li>
<li>&#x58F0;&#x660E;&#x4E8B;&#x4EF6;&#x53E5;&#x67C4;<br>&#x793A;&#x4F8B;&#xFF1A;<br><code>esp_event_handler_instance_t instance_any_id;</code>id<br><code>esp_event_handler_instance_t instance_got_ip;</code>&#x83B7;&#x53D6;ip</li>
<li>&#x6CE8;&#x518C;&#x4E8B;&#x4EF6;<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ESP_ERROR_CHECK(esp_event_handler_instance_register(WIFI_EVENT,<span class="comment">//&#x4E8B;&#x4EF6;&#x7C7B;&#x578B;</span></span><br><span class="line">                                        ESP_EVENT_ANY_ID,<span class="comment">//&#x4E8B;&#x4EF6;id</span></span><br><span class="line">                                        &amp;wifi_event_handler,<span class="comment">//&#x5904;&#x7406;&#x51FD;&#x6570;</span></span><br><span class="line">                                        <span class="literal">NULL</span>,<span class="comment">//&#x5904;&#x7406;&#x51FD;&#x6570;&#x53C2;&#x6570;</span></span><br><span class="line">                                        &amp;instance_any_id<span class="comment">//&#x5B9E;&#x4F8B;&#x5316;&#x53C2;&#x6570;</span></span><br><span class="line">                                        ));</span><br><span class="line">ESP_ERROR_CHECK(esp_event_handler_instance_register(IP_EVENT,</span><br><span class="line">                                        IP_EVENT_STA_GOT_IP,</span><br><span class="line">                                        &amp;wifi_event_handler,</span><br><span class="line">                                        <span class="literal">NULL</span>,</span><br><span class="line">                                        &amp;instance_got_ip</span><br><span class="line">                                        ));</span><br></pre></td></tr></table></figure>
<strong>&#x6CE8;&#x518C;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x51FD;&#x6570;&#x540E;&#x8981;&#x5B9A;&#x4E49;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x51FD;&#x6570;</strong></li>
<li>&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x51FD;&#x6570;&#x8BF4;&#x660E;<br>&#x5982;&#x679C;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x51FD;&#x6570;&#x662F;&#x4E00;&#x4E2A;&#xFF0C;&#x90A3;&#x8981;&#x6839;&#x636E;&#x4E8B;&#x4EF6;&#x7EC4;&#x7684;&#x60C5;&#x51B5;&#x6765;&#x901A;&#x77E5;&#x54EA;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x54CD;&#x5E94;&#xFF0C;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E8B;&#x4EF6;&#x7EC4;&#x6765;&#x7BA1;&#x7406;&#x4E0D;&#x540C;&#x7684;&#x4E8B;&#x4EF6;&#x3002;&#x5177;&#x4F53;&#x5982;&#x4F55;&#x505A;&#x5728;&#x4E0B;&#x8FF0;&#x7684;&#x5185;&#x5BB9;&#x4E2D;</li>
</ol>
<h5 id="&#x5B9E;&#x6218;-1"><a href="#&#x5B9E;&#x6218;-1" class="headerlink" title="&#x5B9E;&#x6218;"></a>&#x5B9E;&#x6218;</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//wifi_driver.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _WIFI_DRIVER_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _WIFI_DRIVER_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/FreeRTOS.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/semphr.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">    <span class="type">char</span> ssid[<span class="number">32</span>];</span><br><span class="line">    <span class="type">char</span> password[<span class="number">64</span>];</span><br><span class="line">    <span class="comment">// char ip[16];</span></span><br><span class="line">    <span class="comment">// char gw[16];</span></span><br><span class="line">    <span class="comment">// char netmask[16];</span></span><br><span class="line">} <span class="type">wifi_info_config_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> sta_ip[<span class="number">16</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="type">bool</span> sta_connected;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">bool</span> ap_active;</span><br><span class="line"><span class="keyword">extern</span> SemaphoreHandle_t wifiStaConnectedHandle;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> {</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_config_ap</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_config_sta</span><span class="params">(<span class="type">wifi_info_config_t</span> *config)</span>;</span><br><span class="line">    <span class="type">bool</span> <span class="title function_">wifi_has_saved_config</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_save_config</span><span class="params">(<span class="type">wifi_info_config_t</span> *config)</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_load_config</span><span class="params">(<span class="type">wifi_info_config_t</span> *config)</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_clear_config</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_close_ap</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//wifi_driver.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;wifi_driver.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/FreeRTOS.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/event_groups.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_wifi.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_event.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_err.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIFI_CONNECTED_BIT BIT0 <span class="comment">//&#x8FDE;&#x63A5;&#x6210;&#x529F;&#x4E8B;&#x4EF6;&#x8BBE;&#x7F6E;&#x5728;&#x4E8B;&#x4EF6;&#x7EC4;0&#x4F4D;&#xFF0C;esp32&#x4E2D;&#x5BF9;&#x6240;&#x6709;&#x4F4D;&#x90FD;&#x6709;&#x5B9A;&#x4E49;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIFI_FAIL_BIT      BIT1 <span class="comment">//&#x8FDE;&#x63A5;&#x5931;&#x8D25;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_ESP_MAXIMUM_RETRY 5 <span class="comment">//&#x6700;&#x591A;&#x91CD;&#x8BD5;&#x6B21;&#x6570;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *TAG = <span class="string">&quot;wifi station&quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> s_retry_num = <span class="number">0</span>;</span><br><span class="line"><span class="type">static</span> EventGroupHandle_t s_wifi_event_group;   <span class="comment">//&#x521B;&#x5EFA;&#x4E8B;&#x4EF6;&#x7EC4;&#x53E5;&#x67C4;</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">wifi_event_handler</span><span class="params">(<span class="type">void</span>* arg, <span class="type">esp_event_base_t</span> event_base,</span></span><br><span class="line"><span class="params">                                <span class="type">int32_t</span> event_id, <span class="type">void</span>* event_data)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (event_base == WIFI_EVENT &amp;&amp; event_id == WIFI_EVENT_STA_START) {<span class="comment">//wifi&#x4E8B;&#x4EF6;</span></span><br><span class="line">        esp_wifi_connect();</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (event_base == WIFI_EVENT &amp;&amp; event_id == WIFI_EVENT_STA_DISCONNECTED) {</span><br><span class="line">        <span class="keyword">if</span> (s_retry_num &lt; EXAMPLE_ESP_MAXIMUM_RETRY) {<span class="comment">//&#x5C1D;&#x8BD5;5&#x6B21;&#x8FDE;&#x63A5;&#x4E0D;&#x4E0A;&#x5C31;&#x6253;&#x5370;&#x9519;&#x8BEF;&#x4FE1;&#x606F;</span></span><br><span class="line">            esp_wifi_connect();</span><br><span class="line">            s_retry_num++;</span><br><span class="line">            ESP_LOGI(TAG, <span class="string">&quot;retry to connect to the AP&quot;</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            xEventGroupSetBits(s_wifi_event_group, WIFI_FAIL_BIT);<span class="comment">//&#x7ED9;wifi&#x4E8B;&#x4EF6;&#x7EC4;&#x7684;&#x5931;&#x8D25;&#x4F4D;&#x7F6E;&#x4F4D;</span></span><br><span class="line">        }</span><br><span class="line">        ESP_LOGI(TAG,<span class="string">&quot;connect to the AP fail&quot;</span>);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (event_base == IP_EVENT &amp;&amp; event_id == IP_EVENT_STA_GOT_IP) {<span class="comment">//ip&#x4E8B;&#x4EF6;</span></span><br><span class="line">        <span class="type">ip_event_got_ip_t</span>* event = (<span class="type">ip_event_got_ip_t</span>*) event_data;</span><br><span class="line">        ESP_LOGI(TAG, <span class="string">&quot;got ip:&quot;</span> IPSTR, IP2STR(&amp;event-&gt;ip_info.ip));</span><br><span class="line">        s_retry_num = <span class="number">0</span>;</span><br><span class="line">        xEventGroupSetBits(s_wifi_event_group, WIFI_CONNECTED_BIT);<span class="comment">//&#x7ED9;wifi&#x4E8B;&#x4EF6;&#x7EC4;&#x7684;&#x5DF2;&#x8FDE;&#x63A5;&#x4F4D;&#x7F6E;&#x4F4D;</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">wifi_init_sta</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *ssid, <span class="type">const</span> <span class="type">char</span> *password)</span>{</span><br><span class="line">    s_wifi_event_group = xEventGroupCreate();       <span class="comment">//&#x521B;&#x5EFA;&#x4E8B;&#x4EF6;&#x7EC4;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//&#x521D;&#x59CB;&#x5316;TCP/IP&#x534F;&#x8BAE;&#x6808;</span></span><br><span class="line">    ESP_ERROR_CHECK(esp_netif_init());</span><br><span class="line">    <span class="comment">//&#x521B;&#x5EFA;&#x9ED8;&#x8BA4;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;</span></span><br><span class="line">    ESP_ERROR_CHECK(esp_event_loop_create_default()); </span><br><span class="line"></span><br><span class="line">    <span class="type">esp_netif_t</span> *sta_netif = esp_netif_create_default_wifi_sta();</span><br><span class="line">    assert(sta_netif);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// WiFi&#x914D;&#x7F6E;</span></span><br><span class="line">    <span class="type">wifi_init_config_t</span> cfg = WIFI_INIT_CONFIG_DEFAULT();</span><br><span class="line">    ESP_ERROR_CHECK(esp_wifi_init(&amp;cfg));  </span><br><span class="line"></span><br><span class="line">    <span class="type">esp_event_handler_instance_t</span> instance_any_id;</span><br><span class="line">    <span class="type">esp_event_handler_instance_t</span> instance_got_ip;</span><br><span class="line">    ESP_ERROR_CHECK(esp_event_handler_instance_register(WIFI_EVENT,</span><br><span class="line">                                                        ESP_EVENT_ANY_ID,</span><br><span class="line">                                                        &amp;wifi_event_handler,</span><br><span class="line">                                                        <span class="literal">NULL</span>,</span><br><span class="line">                                                        &amp;instance_any_id));</span><br><span class="line">    ESP_ERROR_CHECK(esp_event_handler_instance_register(IP_EVENT,</span><br><span class="line">                                                        IP_EVENT_STA_GOT_IP,</span><br><span class="line">                                                        &amp;wifi_event_handler,</span><br><span class="line">                                                        <span class="literal">NULL</span>,</span><br><span class="line">                                                        &amp;instance_got_ip));</span><br><span class="line"></span><br><span class="line">    <span class="type">wifi_config_t</span> wifi_config = {</span><br><span class="line">        .sta = {</span><br><span class="line">            .ssid = <span class="string">&quot;&quot;</span>,</span><br><span class="line">            .password = <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="comment">/* Authmode threshold resets to WPA2 as default if password matches WPA2 standards (password len =&gt; 8).</span></span><br><span class="line"><span class="comment">             * If you want to connect the device to deprecated WEP/WPA networks, Please set the threshold value</span></span><br><span class="line"><span class="comment">             * to WIFI_AUTH_WEP/WIFI_AUTH_WPA_PSK and set the password with length and format matching to</span></span><br><span class="line"><span class="comment">             * WIFI_AUTH_WEP/WIFI_AUTH_WPA_PSK standards.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="comment">// .threshold.authmode = ESP_WIFI_SCAN_AUTH_MODE_THRESHOLD,</span></span><br><span class="line">            <span class="comment">// .sae_pwe_h2e = ESP_WIFI_SAE_MODE,</span></span><br><span class="line">            <span class="comment">// .sae_h2e_identifier = EXAMPLE_H2E_IDENTIFIER,</span></span><br><span class="line">        },</span><br><span class="line">    };</span><br><span class="line">    <span class="built_in">strncpy</span>((<span class="type">char</span>*)wifi_config.sta.ssid, ssid, <span class="keyword">sizeof</span>(wifi_config.sta.ssid));</span><br><span class="line">    <span class="built_in">strncpy</span>((<span class="type">char</span>*)wifi_config.sta.password, password, <span class="keyword">sizeof</span>(wifi_config.sta.password));</span><br><span class="line"></span><br><span class="line">    ESP_ERROR_CHECK(esp_wifi_set_mode(WIFI_MODE_STA));</span><br><span class="line">    ESP_ERROR_CHECK(esp_wifi_set_config(ESP_IF_WIFI_STA, &amp;wifi_config));</span><br><span class="line">    ESP_ERROR_CHECK(esp_wifi_start());  </span><br><span class="line">    </span><br><span class="line">    ESP_LOGI(TAG, <span class="string">&quot;wifi_init_sta finished.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Waiting until either the connection is established (WIFI_CONNECTED_BIT) or connection failed for the maximum</span></span><br><span class="line"><span class="comment">     * number of re-tries (WIFI_FAIL_BIT). The bits are set by event_handler() (see above) */</span></span><br><span class="line">    <span class="comment">//&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x4E8B;&#x4EF6;&#x5EFA;&#x7ACB;&#x8D77;&#x6765;&#xFF0C;&#x6216;&#x8005;&#x5C1D;&#x8BD5;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x540E;&#x5931;&#x8D25;&#xFF0C;&#x7531;wifi_event_handler()&#x8BBE;&#x7F6E;&#xFF0C;</span></span><br><span class="line">    <span class="comment">//&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x6CE8;&#x91CA;</span></span><br><span class="line">    EventBits_t bits = xEventGroupWaitBits(s_wifi_event_group,</span><br><span class="line">            WIFI_CONNECTED_BIT | WIFI_FAIL_BIT,</span><br><span class="line">            pdFALSE,</span><br><span class="line">            pdFALSE,</span><br><span class="line">            portMAX_DELAY);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* xEventGroupWaitBits() returns the bits before the call returned, hence we can test which event actually</span></span><br><span class="line"><span class="comment">     * happened. */</span></span><br><span class="line">    <span class="comment">//&#x6839;&#x636E;&#x4E8B;&#x4EF6;&#x4F4D;&#x6765;&#x6D4B;&#x8BD5;&#x4E8B;&#x4EF6;&#x662F;&#x5426;&#x53D1;&#x751F;</span></span><br><span class="line">    <span class="keyword">if</span> (bits &amp; WIFI_CONNECTED_BIT) {</span><br><span class="line">        ESP_LOGI(TAG, <span class="string">&quot;connected to ap SSID:%s password:%s&quot;</span>,ssid, password);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (bits &amp; WIFI_FAIL_BIT) {</span><br><span class="line">        ESP_LOGI(TAG, <span class="string">&quot;Failed to connect to SSID:%s, password:%s&quot;</span>,ssid, password);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        ESP_LOGE(TAG, <span class="string">&quot;UNEXPECTED EVENT&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<p><a id="section&#x914D;&#x7F51;"></a></p>
<h4 id="AP-STA&#x6A21;&#x5F0F;&#x914D;&#x7F51;"><a href="#AP-STA&#x6A21;&#x5F0F;&#x914D;&#x7F51;" class="headerlink" title="AP+STA&#x6A21;&#x5F0F;&#x914D;&#x7F51;"></a>AP+STA&#x6A21;&#x5F0F;&#x914D;&#x7F51;</h4><p>&#x672C;&#x8282;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x63D0;&#x4F9B;&#x4E00;&#x79CD;AP+STA&#x6A21;&#x5F0F;&#x7684;&#x7B80;&#x5355;&#x914D;&#x7F51;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD8;&#x5904;&#x4E8E;&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x4E86;&#x89E3;http&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8BF7;&#x5728;&#x9605;&#x8BFB;&#x672C;&#x8282;&#x524D;&#x9605;&#x8BFB;<a href="#sectionHTTP%E6%9C%8D%E5%8A%A1%E5%99%A8">HTTP&#x670D;&#x52A1;&#x5668;&#x7684;&#x90E8;&#x5206;</a><br><strong>&#x539F;&#x7406;</strong>&#xFF1A;</p>
<ol>
<li>esp32&#x5F00;&#x542F;STA+AP&#x6A21;&#x5F0F;&#xFF0C;&#x624B;&#x673A;&#x8FDE;&#x63A5;esp32&#x70ED;&#x70B9;&#xFF0C;&#x70ED;&#x70B9;&#x540D;&#x79F0;&#x548C;&#x5BC6;&#x7801;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;esp32&#x7684;ap&#x6A21;&#x5F0F;&#x9ED8;&#x8BA4;&#x7684;ip(192.168.4.1)&#xFF0C;</li>
<li>&#x7528;&#x8FD9;&#x4E2A;ip&#x8BBF;&#x95EE;http&#x8D44;&#x6E90;&#xFF0C;&#x8BF7;&#x6C42;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x7528;&#x4E8E;&#x586B;&#x5199;WiFi&#x540D;&#x79F0;&#x548C;&#x5BC6;&#x7801;&#xFF0C;&#x5185;&#x90E8;&#x8FD4;&#x56DE;&#x5E76;&#x5B58;&#x5165;esp32&#x7684;<code>NVS</code>&#xFF0C;&#x4E0D;&#x4E86;&#x89E3;&#x7684;&#x540C;&#x5B66;&#x770B;<a target="_blank" rel="noopener" href="https://duruofu.github.io/ESP32-Guide/docs/guide/04.%E5%A4%96%E8%AE%BE%E5%AD%A6%E4%B9%A0/4.2-%E5%AD%98%E5%82%A8%E5%A4%96%E8%AE%BE/4.2.2-%E9%9D%9E%E6%98%93%E5%A4%B1%E6%80%A7%E5%AD%98%E5%82%A8/%E9%9D%9E%E6%98%93%E5%A4%B1%E6%80%A7%E5%AD%98%E5%82%A8.html">&#x8FD9;&#x4E2A;</a></li>
<li>&#x70B9;&#x51FB;&#x8FDE;&#x63A5;&#x540E;&#xFF0C;esp32&#x4F7F;&#x7528;&#x7528;&#x6237;&#x586B;&#x5199;&#x7684;WiFi&#x4FE1;&#x606F;&#x8FDE;&#x63A5;WiFi</li>
</ol>
<table>
<thead>
<tr>
<th>&#x6210;&#x529F;</th>
<th>&#x5931;&#x8D25;</th>
</tr>
</thead>
<tbody><tr>
<td>&#x663E;&#x793A;&#x914D;&#x7F6E;&#x6210;&#x529F;&#xFF0C;&#x624B;&#x52A8;&#x5237;&#x65B0;&#x4E00;&#x4E0B;&#x9875;&#x9762;&#xFF0C;&#x70B9;&#x51FB;&#x4E0B;&#x4E00;&#x6B65;</td>
<td>&#x663E;&#x793A;&#x914D;&#x7F6E;&#x9519;&#x8BEF;&#xFF0C;&#x8FD4;&#x56DE;&#x914D;&#x7F6E;&#x9875;&#x9762;</td>
</tr>
</tbody></table>
<ol start="4">
<li>&#x8FD9;&#x91CC;&#x4E00;&#x822C;&#x8FD8;&#x8FDE;&#x63A5;&#x7684;&#x662F;esp32&#x7684;&#x70ED;&#x70B9;&#xFF0C;&#x663E;&#x793A;&#x5206;&#x914D;&#x7684;ip&#x5730;&#x5740;&#x548C;&#x5173;&#x95ED;ap&#x6A21;&#x5F0F;&#x529F;&#x80FD;&#x3002;&#x63A8;&#x8350;&#x914D;&#x7F51;&#x6210;&#x529F;&#x540E;&#x5173;&#x95ED;ap&#xFF0C;&#x6BD4;&#x8F83;&#x8017;&#x7535;&#x3002;</li>
<li>&#x70B9;&#x51FB;&#x8FDE;&#x63A5;&#x540E;&#x4F1A;&#x8DF3;&#x8F6C;&#x5230;&#x8DEF;&#x7531;&#x5668;&#x4E3A;esp32&#x5206;&#x914D;&#x7684;&#x7F51;&#x5740;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x6CA1;&#x6709;&#x53CD;&#x5E94;&#xFF0C;&#x56E0;&#x4E3A;esp32&#x4E0D;&#x54CD;&#x5E94;&#x8DEF;&#x7531;&#x5206;&#x914D;&#x7684;ip&#xFF1B;&#x8FD9;&#x65F6;&#x5019;&#x4E0D;&#x8981;&#x5173;&#x95ED;&#x7F51;&#x9875;&#x5C06;&#x8FDE;&#x63A5;esp32&#x7684;&#x8BBE;&#x5907;<strong>&#x5207;&#x6362;</strong>&#x5230;&#x914D;&#x7F6E;&#x7684;&#x5C40;&#x57DF;&#x7F51;&#xFF0C;&#x518D;&#x5237;&#x65B0;&#x4E00;&#x4E0B;&#x3002;</li>
<li>&#x70B9;&#x51FB;&#x8BBF;&#x95EE;&#x8BBE;&#x5907;&#xFF0C;&#x81EA;&#x52A8;&#x8DF3;&#x8F6C;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x63A7;&#x5236;&#x7F51;&#x9875;</li>
<li>&#x76EE;&#x524D;&#x8FD8;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x56FA;&#x5B9A;ip&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x8FDE;&#x63A5;&#x9636;&#x6BB5;&#x7528;&#x4E32;&#x53E3;&#x67E5;&#x770B;&#x5206;&#x914D;&#x7684;ip&#x5730;&#x5740;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x6E05;&#x9664;&#x4FDD;&#x5B58;&#x7684;wifi&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;esp-idf&#x7684;&#x6E05;&#x7406;flash&#x7684;&#x5DE5;&#x5177;&#x5E76;&#x91CD;&#x65B0;&#x70E7;&#x5F55;&#x4EE3;&#x7801;&#x3002;&#x6E90;&#x7801;&#x5904;&#x4E8E;debug&#x9636;&#x6BB5;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x9636;&#x6BB5;&#x4F1A;&#x81EA;&#x52A8;&#x6E05;&#x7406;nvs&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x77E5;&#x9053;&#x4E3A;&#x4EC0;&#x4E48;&#x6E05;&#x7406;&#x4E0D;&#x4E86;wifi&#x4FE1;&#x606F;&#xFF0C;&#x540E;&#x7EED;&#x4F18;&#x5316;</li>
</ol>
<h5 id="&#x5B9E;&#x6218;-2"><a href="#&#x5B9E;&#x6218;-2" class="headerlink" title="&#x5B9E;&#x6218;"></a>&#x5B9E;&#x6218;</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//wifi_driver.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _WIFI_DRIVER_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _WIFI_DRIVER_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/FreeRTOS.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/semphr.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">    <span class="type">char</span> ssid[<span class="number">32</span>];</span><br><span class="line">    <span class="type">char</span> password[<span class="number">64</span>];</span><br><span class="line">    <span class="comment">// char ip[16];</span></span><br><span class="line">    <span class="comment">// char gw[16];</span></span><br><span class="line">    <span class="comment">// char netmask[16];</span></span><br><span class="line">} <span class="type">wifi_info_config_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> sta_ip[<span class="number">16</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="type">bool</span> sta_connected;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">bool</span> ap_active;</span><br><span class="line"><span class="keyword">extern</span> SemaphoreHandle_t wifiStaConnectedHandle;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> {</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_init</span><span class="params">(<span class="type">void</span>)</span>;       <span class="comment">//&#x521D;&#x59CB;&#x5316;</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_config_ap</span><span class="params">(<span class="type">void</span>)</span>;  <span class="comment">//&#x8BBE;&#x7F6E;ap&#x6A21;&#x5F0F;</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_config_sta</span><span class="params">(<span class="type">wifi_info_config_t</span> *config)</span>;   <span class="comment">//&#x8BBE;&#x7F6E;sta&#x6A21;&#x5F0F;</span></span><br><span class="line">    <span class="type">bool</span> <span class="title function_">wifi_has_saved_config</span><span class="params">(<span class="type">void</span>)</span>;                   <span class="comment">//&#x67E5;&#x770B;&#x662F;&#x5426;&#x6709;&#x4FDD;&#x5B58;&#x7684;&#x914D;&#x7F6E;</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_save_config</span><span class="params">(<span class="type">wifi_info_config_t</span> *config)</span>;  <span class="comment">//&#x4FDD;&#x5B58;wifi&#x914D;&#x7F6E;</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_load_config</span><span class="params">(<span class="type">wifi_info_config_t</span> *config)</span>;  <span class="comment">//&#x52A0;&#x8F7D;&#x914D;&#x7F6E;</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_clear_config</span><span class="params">(<span class="type">void</span>)</span>;                       <span class="comment">//&#x6E05;&#x9664;&#x914D;&#x7F6E;</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">wifi_close_ap</span><span class="params">(<span class="type">void</span>)</span>;                           <span class="comment">//&#x5173;&#x95ED;ap&#x6A21;&#x5F0F;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line"><span class="comment">//wifi_driver.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;wifi_driver.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_wifi.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_event.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_check.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_netif.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lwip/ip_addr.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;nvs_flash.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;nvs.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//wifi&#x4E8B;&#x4EF6;&#x7EC4;&#x4F4D;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIFI_CONNECTED_BIT BIT0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIFI_FAIL_BIT      BIT1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_ESP_MAXIMUM_RETRY 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//AP&#x6A21;&#x5F0F;&#x4FE1;&#x606F;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_ESP_WIFI_AP_SSID            <span class="string">&quot;ESP_WIFI_AP&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_ESP_WIFI_AP_PASSWD          <span class="string">&quot;12345678&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_ESP_WIFI_CHANNEL            6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_MAX_STA_CONN                4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//nvs&#x4FDD;&#x5B58;wifi&#x914D;&#x7F6E;</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *NVS_NAMESPACE = <span class="string">&quot;wifi_config&quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *NVS_KEY = <span class="string">&quot;sta_config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8FDE;&#x63A5;&#x6A21;&#x5F0F;&#x4FE1;&#x606F;</span></span><br><span class="line"><span class="type">char</span> sta_ip[<span class="number">16</span>] = <span class="string">&quot;0.0.0.0&quot;</span>;</span><br><span class="line"><span class="type">bool</span> sta_connected = <span class="literal">false</span>;</span><br><span class="line"><span class="type">bool</span> ap_active = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x65E5;&#x5FD7;&#x4FE1;&#x606F;</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *TAG_AP = <span class="string">&quot;WiFi SoftAP&quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *TAG_STA = <span class="string">&quot;WiFi Sta&quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> s_retry_num = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// &#x58F0;&#x660E;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x6307;&#x9488;</span></span><br><span class="line"><span class="type">static</span> <span class="type">esp_netif_t</span> *sta_netif = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">esp_netif_t</span> *ap_netif = <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">//&#x521B;&#x5EFA;&#x4E8B;&#x4EF6;&#x7EC4;&#x53E5;&#x67C4;</span></span><br><span class="line"><span class="type">static</span> EventGroupHandle_t s_wifi_event_group;   </span><br><span class="line"><span class="comment">//&#x521B;&#x5EFA;sta&#x8FDE;&#x63A5;&#x6210;&#x529F;&#x4FE1;&#x53F7;&#x91CF;</span></span><br><span class="line">SemaphoreHandle_t wifiStaConnectedHandle = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">wifi_event_handler</span><span class="params">(<span class="type">void</span>* arg, <span class="type">esp_event_base_t</span> event_base,</span></span><br><span class="line"><span class="params">                                <span class="type">int32_t</span> event_id, <span class="type">void</span>* event_data)</span>{</span><br><span class="line">    <span class="keyword">if</span> (event_base == WIFI_EVENT &amp;&amp; event_id == WIFI_EVENT_AP_STACONNECTED) </span><br><span class="line">    {</span><br><span class="line">        <span class="comment">//wifi_event_ap_staconnected_t *event = (wifi_event_ap_staconnected_t *) event_data;</span></span><br><span class="line">        ESP_LOGI(TAG_AP, <span class="string">&quot;Station connected to AP&quot;</span>);</span><br><span class="line">    } </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (event_base == WIFI_EVENT &amp;&amp; event_id == WIFI_EVENT_AP_STADISCONNECTED) </span><br><span class="line">    {</span><br><span class="line">        <span class="comment">//wifi_event_ap_stadisconnected_t *event = (wifi_event_ap_stadisconnected_t *) event_data;</span></span><br><span class="line">        ESP_LOGI(TAG_AP, <span class="string">&quot;Station disconnected to AP&quot;</span>);</span><br><span class="line">    } </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (event_base == WIFI_EVENT &amp;&amp; event_id == WIFI_EVENT_STA_START) </span><br><span class="line">    {</span><br><span class="line">        esp_wifi_connect();</span><br><span class="line">        s_retry_num = <span class="number">0</span>;</span><br><span class="line">        ESP_LOGI(TAG_STA, <span class="string">&quot;Station started&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(event_base == WIFI_EVENT &amp;&amp; event_id == WIFI_EVENT_STA_DISCONNECTED) </span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (s_retry_num &lt; EXAMPLE_ESP_MAXIMUM_RETRY) {<span class="comment">//&#x5C1D;&#x8BD5;5&#x6B21;&#x8FDE;&#x63A5;&#x4E0D;&#x4E0A;&#x5C31;&#x6253;&#x5370;&#x9519;&#x8BEF;&#x4FE1;&#x606F;</span></span><br><span class="line">            esp_wifi_connect();</span><br><span class="line">            s_retry_num++;</span><br><span class="line">            ESP_LOGI(TAG_STA, <span class="string">&quot;retry to connect to the AP&quot;</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">//sta&#x8FDE;&#x63A5;&#x5931;&#x8D25;</span></span><br><span class="line">            xEventGroupSetBits(s_wifi_event_group, WIFI_FAIL_BIT);<span class="comment">//&#x7ED9;wifi&#x4E8B;&#x4EF6;&#x7EC4;&#x7684;&#x5931;&#x8D25;&#x4F4D;&#x7F6E;&#x4F4D;</span></span><br><span class="line">            sta_connected = <span class="literal">false</span>;</span><br><span class="line">            xSemaphoreGive(wifiStaConnectedHandle);</span><br><span class="line">            ESP_LOGE(TAG_STA, <span class="string">&quot;&#x8D85;&#x8FC7;&#x6700;&#x5927;&#x91CD;&#x8FDE;&#x6B21;&#x6570;,&#x8FDE;&#x63A5;&#x5931;&#x8D25;&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// &#x542F;&#x7528; AP &#x6A21;&#x5F0F;&#x5141;&#x8BB8;&#x91CD;&#x65B0;&#x914D;&#x7F6E;</span></span><br><span class="line">            <span class="keyword">if</span> (!ap_active) {</span><br><span class="line">                wifi_config_ap(); </span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (event_base == IP_EVENT &amp;&amp; event_id == IP_EVENT_STA_GOT_IP) </span><br><span class="line">    {<span class="comment">//ip&#x4E8B;&#x4EF6;</span></span><br><span class="line">        <span class="type">ip_event_got_ip_t</span> *event = (<span class="type">ip_event_got_ip_t</span> *) event_data;</span><br><span class="line">        ESP_LOGI(TAG_STA, <span class="string">&quot;Got IP:&quot;</span> IPSTR, IP2STR(&amp;event-&gt;ip_info.ip));</span><br><span class="line">        <span class="built_in">sprintf</span>(sta_ip, IPSTR, IP2STR(&amp;event-&gt;ip_info.ip));</span><br><span class="line">        s_retry_num = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//&#x8FDE;&#x63A5;&#x6210;&#x529F;</span></span><br><span class="line">        sta_connected = <span class="literal">true</span>;</span><br><span class="line">        xSemaphoreGive(wifiStaConnectedHandle);</span><br><span class="line">        xEventGroupSetBits(s_wifi_event_group, WIFI_CONNECTED_BIT);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">wifi_init</span><span class="params">(<span class="type">void</span>)</span>{</span><br><span class="line">    <span class="comment">//&#x521B;&#x5EFA;&#x4E8C;&#x503C;&#x4FE1;&#x53F7;&#x91CF;&#xFF0C;wifi&#x8FDE;&#x63A5;&#x6210;&#x529F;&#x4FE1;&#x53F7;&#x91CF;</span></span><br><span class="line">    wifiStaConnectedHandle = xSemaphoreCreateBinary();</span><br><span class="line">    <span class="comment">//&#x521D;&#x59CB;&#x5316;&#x65F6;&#x95F4;&#x7EC4;</span></span><br><span class="line">    s_wifi_event_group = xEventGroupCreate();</span><br><span class="line">    <span class="comment">//&#x521D;&#x59CB;&#x5316;TCP/IP&#x534F;&#x8BAE;&#x6808;</span></span><br><span class="line">    ESP_ERROR_CHECK(esp_netif_init());</span><br><span class="line">    <span class="comment">//&#x521B;&#x5EFA;&#x9ED8;&#x8BA4;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;</span></span><br><span class="line">    ESP_ERROR_CHECK(esp_event_loop_create_default()); </span><br><span class="line">    <span class="comment">// &#x521B;&#x5EFA;&#x9ED8;&#x8BA4;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;</span></span><br><span class="line">    <span class="keyword">if</span> (sta_netif == <span class="literal">NULL</span>) {</span><br><span class="line">        sta_netif = esp_netif_create_default_wifi_sta();</span><br><span class="line">        assert(sta_netif != <span class="literal">NULL</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// WiFi&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;</span></span><br><span class="line">    <span class="type">wifi_init_config_t</span> cfg = WIFI_INIT_CONFIG_DEFAULT();</span><br><span class="line">    ESP_ERROR_CHECK(esp_wifi_init(&amp;cfg)); </span><br><span class="line"></span><br><span class="line">    <span class="comment">//wifi_config_sta(const char *ssid, const char *password);</span></span><br><span class="line">    <span class="type">esp_event_handler_instance_t</span> instance_any_id;</span><br><span class="line">    <span class="type">esp_event_handler_instance_t</span> instance_got_ip;</span><br><span class="line"></span><br><span class="line">    ESP_ERROR_CHECK(esp_event_handler_instance_register(WIFI_EVENT,</span><br><span class="line">                                                        ESP_EVENT_ANY_ID,</span><br><span class="line">                                                        &amp;wifi_event_handler,</span><br><span class="line">                                                        <span class="literal">NULL</span>,</span><br><span class="line">                                                        &amp;instance_any_id));</span><br><span class="line">    ESP_ERROR_CHECK(esp_event_handler_instance_register(IP_EVENT,</span><br><span class="line">                                                        IP_EVENT_STA_GOT_IP,</span><br><span class="line">                                                        &amp;wifi_event_handler,</span><br><span class="line">                                                        <span class="literal">NULL</span>,</span><br><span class="line">                                                        &amp;instance_got_ip));</span><br><span class="line">    <span class="comment">// &#x68C0;&#x67E5;&#x662F;&#x5426;&#x6709;&#x4FDD;&#x5B58;&#x7684;&#x914D;&#x7F6E;</span></span><br><span class="line">    <span class="keyword">if</span> (wifi_has_saved_config()) {</span><br><span class="line">        <span class="type">wifi_info_config_t</span> config;</span><br><span class="line">        wifi_load_config(&amp;config);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// &#x53EA;&#x5F00;&#x542F;STA&#x6A21;&#x5F0F;</span></span><br><span class="line">        ESP_ERROR_CHECK(esp_wifi_set_mode(WIFI_MODE_STA));</span><br><span class="line">        wifi_config_sta(&amp;config);</span><br><span class="line">        ap_active = <span class="literal">false</span>;</span><br><span class="line">        ESP_LOGI(TAG_STA, <span class="string">&quot;&#x4F7F;&#x7528;&#x4FDD;&#x5B58;&#x7684;&#x914D;&#x7F6E;&#x8FDE;&#x63A5;WiFi: %s&quot;</span>, config.ssid);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// &#x5F00;&#x542F;AP+STA&#x6A21;&#x5F0F;</span></span><br><span class="line">        wifi_config_ap(); </span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// &#x542F;&#x52A8;WiFi</span></span><br><span class="line">    ESP_ERROR_CHECK(esp_wifi_start());</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="type">void</span> <span class="title function_">wifi_config_ap</span><span class="params">(<span class="type">void</span>)</span>{</span><br><span class="line">    ESP_LOGI(TAG_AP, <span class="string">&quot;Starting AP mode...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x521B;&#x5EFA;AP&#x7F51;&#x7EDC;&#x63A5;&#x53E3;</span></span><br><span class="line">    <span class="keyword">if</span> (ap_netif == <span class="literal">NULL</span>) {</span><br><span class="line">        ap_netif = esp_netif_create_default_wifi_ap();</span><br><span class="line">        assert(ap_netif != <span class="literal">NULL</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="type">wifi_config_t</span> wifi_ap_config = {</span><br><span class="line">        .ap = {</span><br><span class="line">            .ssid = EXAMPLE_ESP_WIFI_AP_SSID,</span><br><span class="line">            .ssid_len = <span class="built_in">strlen</span>(EXAMPLE_ESP_WIFI_AP_SSID),</span><br><span class="line">            .channel = EXAMPLE_ESP_WIFI_CHANNEL,</span><br><span class="line">            .password = EXAMPLE_ESP_WIFI_AP_PASSWD,</span><br><span class="line">            .max_connection = EXAMPLE_MAX_STA_CONN,</span><br><span class="line">            .authmode = WIFI_AUTH_WPA2_PSK,</span><br><span class="line">            .pmf_cfg = {</span><br><span class="line">                .required = <span class="literal">false</span>,</span><br><span class="line">            },</span><br><span class="line">        },</span><br><span class="line">    };</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strlen</span>(EXAMPLE_ESP_WIFI_AP_PASSWD) == <span class="number">0</span>) {</span><br><span class="line">        wifi_ap_config.ap.authmode = WIFI_AUTH_OPEN;</span><br><span class="line">    }</span><br><span class="line">    ESP_ERROR_CHECK(esp_wifi_set_mode(WIFI_MODE_APSTA));</span><br><span class="line">    ESP_ERROR_CHECK(esp_wifi_set_config(WIFI_IF_AP, &amp;wifi_ap_config));</span><br><span class="line"></span><br><span class="line">    ap_active = <span class="literal">true</span>;</span><br><span class="line">    ESP_LOGI(TAG_AP, <span class="string">&quot;AP+STA&#x6A21;&#x5F0F;&#x542F;&#x52A8;. AP SSID: %s&quot;</span>, EXAMPLE_ESP_WIFI_AP_SSID);</span><br><span class="line">    <span class="comment">// ESP_LOGI(TAG_AP, &quot;wifi_init_softap finished. SSID:%s password:%s channel:%d&quot;,</span></span><br><span class="line">    <span class="comment">//          EXAMPLE_ESP_WIFI_AP_SSID, EXAMPLE_ESP_WIFI_AP_PASSWD, EXAMPLE_ESP_WIFI_CHANNEL);</span></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="type">void</span> <span class="title function_">wifi_config_sta</span><span class="params">(<span class="type">wifi_info_config_t</span> *config)</span>{</span><br><span class="line">    ESP_LOGI(TAG_STA, <span class="string">&quot;Connecting to WiFi: %s&quot;</span>, config-&gt;ssid);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x521B;&#x5EFA;STA&#x7F51;&#x7EDC;&#x63A5;&#x53E3;</span></span><br><span class="line">    <span class="keyword">if</span> (sta_netif == <span class="literal">NULL</span>) {</span><br><span class="line">        sta_netif = esp_netif_create_default_wifi_sta();</span><br><span class="line">        assert(sta_netif != <span class="literal">NULL</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">wifi_config_t</span> wifi_sta_config = {</span><br><span class="line">        .sta = {</span><br><span class="line">            .ssid = <span class="string">&quot;NULL&quot;</span>,</span><br><span class="line">            .password = <span class="string">&quot;NULL&quot;</span>,</span><br><span class="line">            <span class="comment">/* Authmode threshold resets to WPA2 as default if password matches WPA2 standards (password len =&gt; 8).</span></span><br><span class="line"><span class="comment">             * If you want to connect the device to deprecated WEP/WPA networks, Please set the threshold value</span></span><br><span class="line"><span class="comment">             * to WIFI_AUTH_WEP/WIFI_AUTH_WPA_PSK and set the password with length and format matching to</span></span><br><span class="line"><span class="comment">             * WIFI_AUTH_WEP/WIFI_AUTH_WPA_PSK standards.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            .threshold.authmode = WIFI_AUTH_WPA2_PSK,</span><br><span class="line">            <span class="comment">// .sae_pwe_h2e = ESP_WIFI_SAE_MODE,</span></span><br><span class="line">            <span class="comment">// .sae_h2e_identifier = EXAMPLE_H2E_IDENTIFIER,</span></span><br><span class="line">        },</span><br><span class="line">    };</span><br><span class="line">    <span class="built_in">strncpy</span>((<span class="type">char</span>*)wifi_sta_config.sta.ssid, config-&gt;ssid, <span class="keyword">sizeof</span>(wifi_sta_config.sta.ssid));</span><br><span class="line">    <span class="built_in">strncpy</span>((<span class="type">char</span>*)wifi_sta_config.sta.password, config-&gt;password, <span class="keyword">sizeof</span>(wifi_sta_config.sta.password));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ESP_ERROR_CHECK(esp_wifi_set_mode(WIFI_MODE_STA));</span></span><br><span class="line">    ESP_ERROR_CHECK(esp_wifi_set_config(WIFI_IF_STA, &amp;wifi_sta_config));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// // &#x8BBE;&#x7F6E;&#x9759;&#x6001;IP</span></span><br><span class="line">    <span class="comment">// if (strlen(config-&gt;ip) &gt; 0 &amp;&amp; strlen(config-&gt;gw) &gt; 0 &amp;&amp; strlen(config-&gt;netmask) &gt; 0) {</span></span><br><span class="line">    <span class="comment">//     esp_netif_ip_info_t ip_info;</span></span><br><span class="line">    <span class="comment">//     memset(&amp;ip_info, 0, sizeof(ip_info));</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">//     ip_info.ip.addr = ipaddr_addr(config-&gt;ip);</span></span><br><span class="line">    <span class="comment">//     ip_info.gw.addr = ipaddr_addr(config-&gt;gw);</span></span><br><span class="line">    <span class="comment">//     ip_info.netmask.addr = ipaddr_addr(config-&gt;netmask);</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">//     esp_netif_dhcp_status_t dhcp_status;</span></span><br><span class="line">    <span class="comment">//     esp_netif_t* netif = esp_netif_get_handle_from_ifkey(&quot;WIFI_STA_DEF&quot;);</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">//     if (esp_netif_dhcpc_get_status(netif, &amp;dhcp_status) == ESP_OK) {</span></span><br><span class="line">    <span class="comment">//         if (dhcp_status == ESP_NETIF_DHCP_STARTED) {</span></span><br><span class="line">    <span class="comment">//             ESP_ERROR_CHECK(esp_netif_dhcpc_stop(netif));</span></span><br><span class="line">    <span class="comment">//         }</span></span><br><span class="line">    <span class="comment">//         ESP_ERROR_CHECK(esp_netif_set_ip_info(netif, &amp;ip_info));</span></span><br><span class="line">    <span class="comment">//     }</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line">    ESP_LOGI(TAG_STA, <span class="string">&quot;wifi_init_sta finished.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x91CD;&#x7F6E;&#x91CD;&#x8FDE;&#x8BA1;&#x6570;&#x5668;</span></span><br><span class="line">    s_retry_num = <span class="number">0</span>;</span><br><span class="line">    ESP_ERROR_CHECK(esp_wifi_connect());</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">// /* Waiting until either the connection is established (WIFI_CONNECTED_BIT) or connection failed for the maximum</span></span><br><span class="line">    <span class="comment">//  * number of re-tries (WIFI_FAIL_BIT). The bits are set by event_handler() (see above) */</span></span><br><span class="line">    <span class="comment">// //&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x4E8B;&#x4EF6;&#x5EFA;&#x7ACB;&#x8D77;&#x6765;&#xFF0C;&#x6216;&#x8005;&#x5C1D;&#x8BD5;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x540E;&#x5931;&#x8D25;&#xFF0C;&#x7531;wifi_event_handler()&#x8BBE;&#x7F6E;&#xFF0C;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x6CE8;&#x91CA;</span></span><br><span class="line">    <span class="comment">// EventBits_t bits = xEventGroupWaitBits(s_wifi_event_group,</span></span><br><span class="line">    <span class="comment">//         WIFI_CONNECTED_BIT | WIFI_FAIL_BIT,</span></span><br><span class="line">    <span class="comment">//         pdFALSE,</span></span><br><span class="line">    <span class="comment">//         pdFALSE,</span></span><br><span class="line">    <span class="comment">//         portMAX_DELAY);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// /* xEventGroupWaitBits() returns the bits before the call returned, hence we can test which event actually</span></span><br><span class="line">    <span class="comment">//  * happened. */</span></span><br><span class="line">    <span class="comment">// //&#x6839;&#x636E;&#x4E8B;&#x4EF6;&#x4F4D;&#x6765;&#x6D4B;&#x8BD5;&#x4E8B;&#x4EF6;&#x662F;&#x5426;&#x53D1;&#x751F;</span></span><br><span class="line">    <span class="comment">// if (bits &amp; WIFI_CONNECTED_BIT) {</span></span><br><span class="line">    <span class="comment">//     ESP_LOGI(TAG_STA, &quot;connected to ap SSID:%s password:%s&quot;,ssid, password);</span></span><br><span class="line">    <span class="comment">// } else if (bits &amp; WIFI_FAIL_BIT) {</span></span><br><span class="line">    <span class="comment">//     ESP_LOGI(TAG_STA, &quot;Failed to connect to SSID:%s, password:%s&quot;,ssid, password);</span></span><br><span class="line">    <span class="comment">// } else {</span></span><br><span class="line">    <span class="comment">//     ESP_LOGE(TAG_STA, &quot;UNEXPECTED EVENT&quot;);</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">wifi_has_saved_config</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">nvs_handle_t</span> nvs;</span><br><span class="line">    <span class="comment">//&#x8BFB;&#x547D;&#x540D;&#x7A7A;&#x95F4;</span></span><br><span class="line">    <span class="type">esp_err_t</span> err = nvs_open(NVS_NAMESPACE, NVS_READONLY, &amp;nvs);</span><br><span class="line">    <span class="keyword">if</span> (err != ESP_OK) {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="type">wifi_info_config_t</span> config;</span><br><span class="line">    <span class="type">size_t</span> required_size = <span class="keyword">sizeof</span>(config);</span><br><span class="line">    <span class="comment">//&#x8BFB;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;</span></span><br><span class="line">    err = nvs_get_blob(nvs, NVS_KEY, &amp;config, &amp;required_size);</span><br><span class="line">    nvs_close(nvs);</span><br><span class="line">    <span class="comment">//&#x4EFB;&#x610F;&#x4E3A;false&#x5219;&#x8FD4;&#x56DE;false</span></span><br><span class="line">    <span class="keyword">return</span> (err == ESP_OK &amp;&amp; required_size == <span class="keyword">sizeof</span>(config) &amp;&amp; <span class="built_in">strlen</span>(config.ssid) &gt; <span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">wifi_save_config</span><span class="params">(<span class="type">wifi_info_config_t</span> *config)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">nvs_handle_t</span> nvs;</span><br><span class="line">    <span class="type">esp_err_t</span> err = nvs_open(NVS_NAMESPACE, NVS_READWRITE, &amp;nvs);</span><br><span class="line">    <span class="keyword">if</span> (err != ESP_OK) {</span><br><span class="line">        ESP_LOGE(<span class="string">&quot;WIFI&quot;</span>, <span class="string">&quot;&#x65E0;&#x6CD5;&#x6253;&#x5F00;NVS&#x547D;&#x540D;&#x7A7A;&#x95F4;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    err = nvs_set_blob(nvs, NVS_KEY, config, <span class="keyword">sizeof</span>(<span class="type">wifi_info_config_t</span>));</span><br><span class="line">    <span class="keyword">if</span> (err != ESP_OK) {</span><br><span class="line">        ESP_LOGE(<span class="string">&quot;WIFI&quot;</span>, <span class="string">&quot;&#x4FDD;&#x5B58;&#x914D;&#x7F6E;&#x5931;&#x8D25;&quot;</span>);</span><br><span class="line">        nvs_close(nvs);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    nvs_commit(nvs);</span><br><span class="line">    nvs_close(nvs);</span><br><span class="line">    ESP_LOGI(<span class="string">&quot;WIFI&quot;</span>, <span class="string">&quot;WiFi&#x914D;&#x7F6E;&#x5DF2;&#x4FDD;&#x5B58;&quot;</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">wifi_load_config</span><span class="params">(<span class="type">wifi_info_config_t</span> *config)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">nvs_handle_t</span> nvs;</span><br><span class="line">    <span class="type">esp_err_t</span> err = nvs_open(NVS_NAMESPACE, NVS_READONLY, &amp;nvs);</span><br><span class="line">    <span class="keyword">if</span> (err != ESP_OK) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="type">size_t</span> required_size = <span class="keyword">sizeof</span>(<span class="type">wifi_info_config_t</span>);</span><br><span class="line">    err = nvs_get_blob(nvs, NVS_KEY, config, &amp;required_size);</span><br><span class="line">    nvs_close(nvs);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (err != ESP_OK || required_size != <span class="keyword">sizeof</span>(<span class="type">wifi_info_config_t</span>)) {</span><br><span class="line">        <span class="built_in">memset</span>(config, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="type">wifi_info_config_t</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">wifi_clear_config</span><span class="params">(<span class="type">void</span>)</span>{</span><br><span class="line">    <span class="comment">// &#x6E05;&#x9664;&#x4FDD;&#x5B58;&#x7684;WiFi&#x914D;&#x7F6E;</span></span><br><span class="line">    <span class="type">nvs_handle_t</span> nvs;</span><br><span class="line">    <span class="keyword">if</span> (nvs_open(NVS_NAMESPACE, NVS_READWRITE, &amp;nvs) == ESP_OK) {</span><br><span class="line">        nvs_erase_key(nvs, NVS_KEY);</span><br><span class="line">        nvs_commit(nvs);</span><br><span class="line">        nvs_close(nvs);</span><br><span class="line">        ESP_LOGI(TAG_STA, <span class="string">&quot;&#x5DF2;&#x6E05;&#x9664;&#x4FDD;&#x5B58;&#x7684;WiFi&#x914D;&#x7F6E;&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">wifi_close_ap</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (ap_active &amp;&amp; sta_connected) {</span><br><span class="line">        ap_active = <span class="literal">false</span>;</span><br><span class="line">        esp_wifi_set_mode(WIFI_MODE_STA);</span><br><span class="line">        ESP_LOGI(TAG_AP, <span class="string">&quot;AP&#x6A21;&#x5F0F;&#x5DF2;&#x5173;&#x95ED;&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// &#x9500;&#x6BC1;AP&#x7F51;&#x7EDC;&#x63A5;&#x53E3;</span></span><br><span class="line">        <span class="keyword">if</span> (ap_netif != <span class="literal">NULL</span>) {</span><br><span class="line">            esp_netif_destroy(ap_netif);</span><br><span class="line">            ap_netif = <span class="literal">NULL</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//http_server.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _HTTP_SERVER_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _HTTP_SERVER_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_http_server.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> {</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">httpd_handle_t</span> <span class="title function_">start_webserver</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">stop_webserver</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//http_server.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_check.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;http_server.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cmd_parser.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;wifi_driver.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIN(x, y) ((x) &lt; (y) ? (x) : (y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_HTTP_QUERY_KEY_MAX_LEN  (64)</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *TAG = <span class="string">&quot;HTTP&quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">httpd_handle_t</span> server = <span class="literal">NULL</span>;        <span class="comment">//&#x7F6E;&#x7A7A;esp_http_server&#x5B9E;&#x4F8B;&#x7684;&#x53E5;&#x67C4;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x7B80;&#x5355;&#x7684;HTML&#x5934;&#x90E8;</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span>* html_header = </span><br><span class="line">    <span class="string">&quot;&lt;!DOCTYPE html&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;html&gt;&lt;head&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;meta charset=\&quot;UTF-8\&quot;&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot;&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;title&gt;ESP32&#x63A7;&#x5236;&lt;/title&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;style&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;body { font-family: Arial, sans-serif; max-width: 500px; margin: 0 auto; padding: 20px; }&quot;</span></span><br><span class="line">    <span class="string">&quot;h1 { color: #333; }&quot;</span></span><br><span class="line">    <span class="string">&quot;form { margin: 20px 0; }&quot;</span></span><br><span class="line">    <span class="string">&quot;input[type=text], input[type=password] { width: 100%; padding: 10px; margin: 5px 0; }&quot;</span></span><br><span class="line">    <span class="string">&quot;input[type=submit] { padding: 10px 20px; background: #4CAF50; color: white; border: none; cursor: pointer; }&quot;</span></span><br><span class="line">    <span class="string">&quot;input[type=submit]:hover { background: #45a049; }&quot;</span></span><br><span class="line">    <span class="string">&quot;.status { padding: 10px; background: #f0f0f0; margin: 10px 0; }&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;/style&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;/head&gt;&lt;body&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x7B80;&#x5355;&#x7684;HTML&#x5C3E;&#x90E8;</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span>* html_footer = <span class="string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x914D;&#x7F51;&#x9875;&#x9762;</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span>* html_form = </span><br><span class="line">    <span class="string">&quot;&lt;h1&gt;WiFi&#x914D;&#x7F6E;&lt;/h1&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;form action=&apos;/config&apos;&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;label for=&apos;ssid&apos;&gt;WiFi&#x540D;&#x79F0;:&lt;/label&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;input type=&apos;text&apos; id=&apos;ssid&apos; name=&apos;ssid&apos; required&gt;&lt;br&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;label for=&apos;password&apos;&gt;&#x5BC6;&#x7801;:&lt;/label&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;input type=&apos;password&apos; id=&apos;password&apos; name=&apos;password&apos;&gt;&lt;br&gt;&quot;</span></span><br><span class="line">    <span class="comment">// &quot;&lt;h3&gt;&#x9759;&#x6001;IP (&#x53EF;&#x9009;)&lt;/h3&gt;&quot;</span></span><br><span class="line">    <span class="comment">// &quot;&lt;label for=&apos;ip&apos;&gt;IP&#x5730;&#x5740;:&lt;/label&gt;&quot;</span></span><br><span class="line">    <span class="comment">// &quot;&lt;input type=&apos;text&apos; id=&apos;ip&apos; name=&apos;ip&apos;&gt;&lt;br&gt;&quot;</span></span><br><span class="line">    <span class="comment">// &quot;&lt;label for=&apos;gw&apos;&gt;&#x7F51;&#x5173;:&lt;/label&gt;&quot;</span></span><br><span class="line">    <span class="comment">// &quot;&lt;input type=&apos;text&apos; id=&apos;gw&apos; name=&apos;gw&apos;&gt;&lt;br&gt;&quot;</span></span><br><span class="line">    <span class="comment">// &quot;&lt;label for=&apos;netmask&apos;&gt;&#x5B50;&#x7F51;&#x63A9;&#x7801;:&lt;/label&gt;&quot;</span></span><br><span class="line">    <span class="comment">// &quot;&lt;input type=&apos;text&apos; id=&apos;netmask&apos; name=&apos;netmask&apos;&gt;&lt;br&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;input type=&apos;submit&apos; value=&apos;&#x8FDE;&#x63A5;&apos;&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;/form&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x914D;&#x7F6E;&#x6210;&#x529F;&#x9875;&#x9762;</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span>* html_success = </span><br><span class="line">    <span class="string">&quot;&lt;h1&gt;&#x914D;&#x7F6E;&#x6210;&#x529F;!&lt;/h1&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;div class=&apos;status&apos;&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;p&gt;&#x6B63;&#x5728;&#x8FDE;&#x63A5;&#x7F51;&#x7EDC;...&lt;/p&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;p&gt;&lt;a href=&apos;/device&apos;&gt;&#x4E0B;&#x4E00;&#x6B65;&lt;/a&gt;&lt;/p&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;/div&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x914D;&#x7F6E;&#x9519;&#x8BEF;</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span>* html_error = </span><br><span class="line">    <span class="string">&quot;&lt;h1&gt;&#x914D;&#x7F6E;&#x9519;&#x8BEF;&lt;/h1&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;div class=&apos;status&apos;&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;p&gt;&#x8BF7;&#x8F93;&#x5165;&#x6709;&#x6548;&#x7684;WiFi&#x540D;&#x79F0;&lt;/p&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;p&gt;&lt;a href=&apos;/&apos;&gt;&#x8FD4;&#x56DE;&#x914D;&#x7F6E;&#x9875;&#x9762;&lt;/a&gt;&lt;/p&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;/div&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x8FDE;&#x63A5;&#x9875;&#x9762;</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span>* html_device = </span><br><span class="line">    <span class="string">&quot;&lt;h1&gt;&#x8BBE;&#x5907;&#x63A7;&#x5236;&lt;/h1&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;div class=&apos;status&apos;&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;p&gt;&#x8BBE;&#x5907;&#x5DF2;&#x8FDE;&#x63A5;&lt;/p&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;p&gt;IP&#x5730;&#x5740;: %s&lt;/p&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;p&gt;&lt;a href=&apos;http://%s/command&apos;&gt;&#x8BBF;&#x95EE;&#x8BBE;&#x5907;&lt;/a&gt;&lt;/p&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;/div&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;p&gt;&lt;a href=&apos;http://%s/closeap&apos;&gt;&#x5173;&#x95ED;AP&#x6A21;&#x5F0F;&lt;/a&gt;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AP&#x5173;&#x95ED;&#x9875;&#x9762;</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span>* html_ap_off = </span><br><span class="line">    <span class="string">&quot;&lt;h1&gt;AP&#x6A21;&#x5F0F;&#x5DF2;&#x5173;&#x95ED;&lt;/h1&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;div class=&apos;status&apos;&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;p&gt;&#x4F7F;&#x7528;ip&#x5730;&#x5740;&lt;a href=http://%s/command&gt;&#x8BBF;&#x95EE;&#x8BBE;&#x5907;&lt;/a&gt;&lt;/p&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;/div&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span>* html_control = </span><br><span class="line">    <span class="string">&quot;&lt;h1 style=&apos;text-align:center&apos;&gt;&#x673A;&#x5668;&#x4EBA;&#x63A7;&#x5236;&lt;/h1&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;div style=&apos;margin:20px auto;text-align:center&apos;&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;label&gt;&#x901F;&#x5EA6;&#x503C;&#xFF1A;&lt;input type=&apos;number&apos; id=&apos;speed&apos; min=&apos;1&apos; max=&apos;100&apos; value=&apos;70&apos; style=&apos;width:80px&apos;&gt;&lt;/label&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;/div&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;div style=&apos;display:flex;flex-direction:column;align-items:center;gap:12px&apos;&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;button style=&apos;padding:12px 24px;font-size:18px;min-width:60px&apos; onclick=&apos;sendCmd(\&quot;forward\&quot;)&apos;&gt;&#x2191;&lt;/button&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;div style=&apos;display:flex;gap:8px&apos;&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;button style=&apos;padding:12px 24px;font-size:18px;min-width:60px&apos; onclick=&apos;sendCmd(\&quot;left\&quot;)&apos;&gt;&#x2190;&lt;/button&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;button style=&apos;padding:12px 24px;font-size:18px;min-width:60px&apos; onclick=&apos;sendCmd(\&quot;right\&quot;)&apos;&gt;&#x2192;&lt;/button&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;/div&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;button style=&apos;padding:12px 24px;font-size:18px;min-width:60px&apos; onclick=&apos;sendCmd(\&quot;backward\&quot;)&apos;&gt;&#x2193;&lt;/button&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;button style=&apos;padding:12px 24px;font-size:18px;background:#ff4444&apos; onclick=&apos;sendCmd(\&quot;stop\&quot;)&apos;&gt;&#x7D27;&#x6025;&#x505C;&#x6B62;&lt;/button&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;/div&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;script&gt;&quot;</span></span><br><span class="line">    <span class="string">&quot;function sendCmd(cmd){&quot;</span></span><br><span class="line">    <span class="string">&quot;  let speed=document.getElementById(&apos;speed&apos;).value;&quot;</span></span><br><span class="line">    <span class="string">&quot;  fetch(`http://%s/command?cmd=${cmd}&amp;speed=${speed}`);&quot;</span></span><br><span class="line">    <span class="string">&quot;}&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;/script&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* URI &#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77; GET /helloworld &#x8BF7;&#x6C42;&#x65F6;&#x88AB;&#x8C03;&#x7528; */</span></span><br><span class="line"><span class="comment">/* An HTTP GET handler */</span></span><br><span class="line"><span class="type">static</span> <span class="type">esp_err_t</span> <span class="title function_">hello_world_handler</span><span class="params">(<span class="type">httpd_req_t</span> *req)</span></span><br><span class="line">{</span><br><span class="line">	<span class="type">char</span> *buf;</span><br><span class="line">	<span class="type">size_t</span> buf_len;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Get header value string length and allocate memory for length + 1,</span></span><br><span class="line"><span class="comment">	 * extra byte for null termination */</span></span><br><span class="line">	buf_len = httpd_req_get_hdr_value_len(req, <span class="string">&quot;Host&quot;</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (buf_len &gt; <span class="number">1</span>)</span><br><span class="line">	{</span><br><span class="line">		buf = <span class="built_in">malloc</span>(buf_len);</span><br><span class="line">		ESP_RETURN_ON_FALSE(buf, ESP_ERR_NO_MEM, TAG, <span class="string">&quot;buffer alloc failed&quot;</span>);</span><br><span class="line">		<span class="comment">/* Copy null terminated value string into buffer */</span></span><br><span class="line">		<span class="keyword">if</span> (httpd_req_get_hdr_value_str(req, <span class="string">&quot;Host&quot;</span>, buf, buf_len) == ESP_OK)</span><br><span class="line">		{</span><br><span class="line">			ESP_LOGI(TAG, <span class="string">&quot;Found header =&gt; Host: %s&quot;</span>, buf);</span><br><span class="line">		}</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	buf_len = httpd_req_get_hdr_value_len(req, <span class="string">&quot;Test-Header-2&quot;</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (buf_len &gt; <span class="number">1</span>)</span><br><span class="line">	{</span><br><span class="line">		buf = <span class="built_in">malloc</span>(buf_len);</span><br><span class="line">		ESP_RETURN_ON_FALSE(buf, ESP_ERR_NO_MEM, TAG, <span class="string">&quot;buffer alloc failed&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (httpd_req_get_hdr_value_str(req, <span class="string">&quot;Test-Header-2&quot;</span>, buf, buf_len) == ESP_OK)</span><br><span class="line">		{</span><br><span class="line">			ESP_LOGI(TAG, <span class="string">&quot;Found header =&gt; Test-Header-2: %s&quot;</span>, buf);</span><br><span class="line">		}</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	buf_len = httpd_req_get_hdr_value_len(req, <span class="string">&quot;Test-Header-1&quot;</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (buf_len &gt; <span class="number">1</span>)</span><br><span class="line">	{</span><br><span class="line">		buf = <span class="built_in">malloc</span>(buf_len);</span><br><span class="line">		ESP_RETURN_ON_FALSE(buf, ESP_ERR_NO_MEM, TAG, <span class="string">&quot;buffer alloc failed&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (httpd_req_get_hdr_value_str(req, <span class="string">&quot;Test-Header-1&quot;</span>, buf, buf_len) == ESP_OK)</span><br><span class="line">		{</span><br><span class="line">			ESP_LOGI(TAG, <span class="string">&quot;Found header =&gt; Test-Header-1: %s&quot;</span>, buf);</span><br><span class="line">		}</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Set some custom headers */</span></span><br><span class="line">	<span class="comment">//&#x8BBE;&#x7F6E;&#x81EA;&#x5B9A;&#x4E49;&#x5934;</span></span><br><span class="line">	httpd_resp_set_hdr(req, <span class="string">&quot;Custom-Header-1&quot;</span>, <span class="string">&quot;Custom-Value-1&quot;</span>);</span><br><span class="line">	httpd_resp_set_hdr(req, <span class="string">&quot;Custom-Header-2&quot;</span>, <span class="string">&quot;Custom-Value-2&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Send response with custom headers and body set as the</span></span><br><span class="line"><span class="comment">	 * string passed in user context*/</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *resp_str = (<span class="type">const</span> <span class="type">char</span> *)req-&gt;user_ctx;		</span><br><span class="line">	httpd_resp_send(req, resp_str, HTTPD_RESP_USE_STRLEN);	<span class="comment">//&#x53D1;&#x9001;resp_str&#x5B57;&#x7B26;&#x4E32;&#x5185;&#x5BB9;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* After sending the HTTP response the old HTTP request</span></span><br><span class="line"><span class="comment">	 * headers are lost. Check if HTTP request headers can be read now. */</span></span><br><span class="line">	<span class="comment">//&#x54CD;&#x5E94;http&#x65E7;&#x8BF7;&#x6C42;&#x540E;&#x68C0;&#x67E5;</span></span><br><span class="line">	<span class="keyword">if</span> (httpd_req_get_hdr_value_len(req, <span class="string">&quot;Host&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">		ESP_LOGI(TAG, <span class="string">&quot;Request headers lost&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ESP_OK;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">httpd_uri_t</span> hello_world = {</span><br><span class="line">    .uri = <span class="string">&quot;/helloworld&quot;</span>,</span><br><span class="line">    .method = HTTP_GET,</span><br><span class="line">    .handler = hello_world_handler,</span><br><span class="line">    .user_ctx = <span class="string">&quot;Hello World!&quot;</span>,</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// static esp_err_t get_status_handler(httpd_req_t *req){</span></span><br><span class="line"><span class="comment">// 	command_params_t get_status_handler;</span></span><br><span class="line"><span class="comment">// 	if(command_get_current_command(&amp;get_status_handler)!=0){</span></span><br><span class="line"><span class="comment">// 		httpd_resp_send_err(req, HTTPD_400_BAD_REQUEST, &quot;Invalid command&quot;);</span></span><br><span class="line"><span class="comment">//         return ESP_OK;</span></span><br><span class="line"><span class="comment">// 	}</span></span><br><span class="line"><span class="comment">// 	char statusString[100];</span></span><br><span class="line"><span class="comment">// 	sprintf(statusString,&quot;Command set: %s, Speed: %d%%, Continuous: %d&quot;,</span></span><br><span class="line"><span class="comment">// 			cmd_strings[get_status_handler.type], get_status_handler.speed, get_status_handler.is_continuous);</span></span><br><span class="line"><span class="comment">// 	httpd_resp_send(req, statusString, HTTPD_RESP_USE_STRLEN);</span></span><br><span class="line"><span class="comment">// 	return ESP_OK;</span></span><br><span class="line"><span class="comment">// }</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// static const httpd_uri_t uri_get_status = {</span></span><br><span class="line"><span class="comment">//     .uri = &quot;/status&quot;,</span></span><br><span class="line"><span class="comment">//     .method = HTTP_GET,</span></span><br><span class="line"><span class="comment">//     .handler = get_status_handler,</span></span><br><span class="line"><span class="comment">//     .user_ctx = NULL,</span></span><br><span class="line"><span class="comment">// };</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// HTTP&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x51FD;&#x6570;</span></span><br><span class="line"><span class="type">static</span> <span class="type">esp_err_t</span> <span class="title function_">root_handler</span><span class="params">(<span class="type">httpd_req_t</span> *req)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">char</span> *html_content = <span class="literal">NULL</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (ap_active &amp;&amp; !sta_connected) {</span><br><span class="line">        <span class="comment">// &#x663E;&#x793A;&#x914D;&#x7F51;&#x9875;&#x9762;</span></span><br><span class="line">        <span class="type">size_t</span> len = <span class="built_in">strlen</span>(html_header) + <span class="built_in">strlen</span>(html_form) + <span class="built_in">strlen</span>(html_footer) + <span class="number">1</span>;</span><br><span class="line">        html_content = <span class="built_in">malloc</span>(len);</span><br><span class="line">        <span class="keyword">if</span> (html_content) {</span><br><span class="line">            <span class="built_in">snprintf</span>(html_content, len, <span class="string">&quot;%s%s%s&quot;</span>, html_header, html_form, html_footer);</span><br><span class="line">            httpd_resp_send(req, html_content, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">            <span class="built_in">free</span>(html_content);</span><br><span class="line">            <span class="keyword">return</span> ESP_OK;</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (sta_connected) {</span><br><span class="line">        <span class="comment">// &#x663E;&#x793A;&#x6210;&#x529F;&#x9875;&#x9762;</span></span><br><span class="line">        <span class="type">size_t</span> len = <span class="built_in">strlen</span>(html_header) + <span class="built_in">strlen</span>(html_success) + <span class="built_in">strlen</span>(html_footer) + <span class="number">1</span>;</span><br><span class="line">        html_content = <span class="built_in">malloc</span>(len);</span><br><span class="line">        <span class="keyword">if</span> (html_content) {</span><br><span class="line">            <span class="built_in">snprintf</span>(html_content, len, <span class="string">&quot;%s%s%s&quot;</span>, html_header, html_success, html_footer);</span><br><span class="line">            httpd_resp_send(req, html_content, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">            <span class="built_in">free</span>(html_content);</span><br><span class="line">            <span class="keyword">return</span> ESP_OK;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// &#x9ED8;&#x8BA4;&#x54CD;&#x5E94;</span></span><br><span class="line">    httpd_resp_send(req, <span class="string">&quot;&#x8BBE;&#x5907;&#x72B6;&#x6001;&#x672A;&#x77E5;&quot;</span>, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">    <span class="keyword">return</span> ESP_OK;</span><br><span class="line">}</span><br><span class="line"><span class="type">static</span> <span class="type">httpd_uri_t</span> root_uri = {</span><br><span class="line">            .uri = <span class="string">&quot;/&quot;</span>,</span><br><span class="line">            .method = HTTP_GET,</span><br><span class="line">            .handler = root_handler</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x914D;&#x7F6E;&#x51FD;&#x6570;</span></span><br><span class="line"><span class="type">static</span> <span class="type">esp_err_t</span> <span class="title function_">config_handler</span><span class="params">(<span class="type">httpd_req_t</span> *req)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">char</span> query[<span class="number">200</span>];</span><br><span class="line">    <span class="keyword">if</span> (httpd_req_get_url_query_str(req, query, <span class="keyword">sizeof</span>(query)) != ESP_OK) {</span><br><span class="line">        httpd_resp_send(req, <span class="string">&quot;&#x65E0;&#x6548;&#x8BF7;&#x6C42;&quot;</span>, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">        <span class="keyword">return</span> ESP_FAIL;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="type">wifi_info_config_t</span> config = {<span class="number">0</span>};</span><br><span class="line">    </span><br><span class="line">    httpd_query_key_value(query, <span class="string">&quot;ssid&quot;</span>, config.ssid, <span class="keyword">sizeof</span>(config.ssid));</span><br><span class="line">    httpd_query_key_value(query, <span class="string">&quot;password&quot;</span>, config.password, <span class="keyword">sizeof</span>(config.password));</span><br><span class="line">    </span><br><span class="line">    ESP_LOGI(<span class="string">&quot;HTTP&quot;</span>, <span class="string">&quot;&#x6536;&#x5230;&#x914D;&#x7F6E;: SSID=%s, PASSWORD=%s&quot;</span>, config.ssid, config.password);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x4FDD;&#x5B58;&#x914D;&#x7F6E;&#x5230;NVS</span></span><br><span class="line">    wifi_save_config(&amp;config);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// &#x8BBE;&#x7F6E;STA&#x914D;&#x7F6E;</span></span><br><span class="line">    wifi_config_sta(&amp;config);</span><br><span class="line">    xSemaphoreTake(wifiStaConnectedHandle, pdTICKS_TO_MS(<span class="number">500</span>));</span><br><span class="line">    <span class="comment">// &#x663E;&#x793A;&#x6210;&#x529F;&#x9875;&#x9762;</span></span><br><span class="line">    <span class="keyword">if</span>(sta_connected == <span class="literal">true</span>){</span><br><span class="line">        <span class="type">size_t</span> len = <span class="built_in">strlen</span>(html_header) + <span class="built_in">strlen</span>(html_success) + <span class="built_in">strlen</span>(html_footer) + <span class="number">1</span>;</span><br><span class="line">        <span class="type">char</span> *html_content = <span class="built_in">malloc</span>(len);</span><br><span class="line">        <span class="keyword">if</span> (html_content)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">snprintf</span>(html_content, len, <span class="string">&quot;%s%s%s&quot;</span>, html_header, html_success, html_footer);</span><br><span class="line">            httpd_resp_send(req, html_content, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">            <span class="built_in">free</span>(html_content);</span><br><span class="line">            <span class="keyword">return</span> ESP_OK;</span><br><span class="line">        }</span><br><span class="line">        httpd_resp_send(req, <span class="string">&quot;&#x914D;&#x7F6E;&#x5DF2;&#x4FDD;&#x5B58;&quot;</span>, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(sta_connected == <span class="literal">false</span>){</span><br><span class="line">        wifi_clear_config();</span><br><span class="line">        <span class="comment">// &#x663E;&#x793A;&#x9519;&#x8BEF;&#x9875;&#x9762;</span></span><br><span class="line">        <span class="type">size_t</span> len = <span class="built_in">strlen</span>(html_header) + <span class="built_in">strlen</span>(html_error) + <span class="built_in">strlen</span>(html_footer) + <span class="number">1</span>;</span><br><span class="line">        <span class="type">char</span> *html_content = <span class="built_in">malloc</span>(len);</span><br><span class="line">        <span class="keyword">if</span> (html_content) {</span><br><span class="line">            <span class="built_in">snprintf</span>(html_content, len, <span class="string">&quot;%s%s%s&quot;</span>, html_header, html_error, html_footer);</span><br><span class="line">            httpd_resp_send(req, html_content, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">            <span class="built_in">free</span>(html_content);</span><br><span class="line">            <span class="keyword">return</span> ESP_OK;</span><br><span class="line">        }</span><br><span class="line">        httpd_resp_send(req, <span class="string">&quot;&#x914D;&#x7F6E;&#x5DF2;&#x5220;&#x9664;&quot;</span>, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ESP_OK;</span><br><span class="line">}</span><br><span class="line"><span class="type">static</span> <span class="type">httpd_uri_t</span> config_uri = {</span><br><span class="line">            .uri = <span class="string">&quot;/config&quot;</span>,</span><br><span class="line">            .method = HTTP_GET,</span><br><span class="line">            .handler = config_handler</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8BBE;&#x5907;&#x63A7;&#x5236;</span></span><br><span class="line"><span class="type">static</span> <span class="type">esp_err_t</span> <span class="title function_">device_handler</span><span class="params">(<span class="type">httpd_req_t</span> *req)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">char</span> html_device_temp[<span class="number">256</span>];</span><br><span class="line">    <span class="built_in">snprintf</span>(html_device_temp, <span class="keyword">sizeof</span>(html_device_temp), html_device, sta_ip, sta_ip, sta_ip);</span><br><span class="line">    <span class="type">size_t</span> len = <span class="built_in">strlen</span>(html_header) + <span class="built_in">strlen</span>(html_device_temp) + <span class="built_in">strlen</span>(html_footer) + <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> *html_content = <span class="built_in">malloc</span>(len);</span><br><span class="line">    <span class="keyword">if</span> (html_content) {</span><br><span class="line">        <span class="built_in">snprintf</span>(html_content, len, <span class="string">&quot;%s%s%s&quot;</span>, html_header, html_device_temp, html_footer);</span><br><span class="line">        httpd_resp_send(req, html_content, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">        <span class="built_in">free</span>(html_content);</span><br><span class="line">        <span class="keyword">return</span> ESP_OK;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// &#x91CD;&#x5B9A;&#x5411;&#x56DE;&#x6839;&#x9875;&#x9762;</span></span><br><span class="line">    httpd_resp_set_status(req, <span class="string">&quot;303 See Other&quot;</span>);</span><br><span class="line">    httpd_resp_set_hdr(req, <span class="string">&quot;Location&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">    httpd_resp_send(req, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ESP_OK;</span><br><span class="line">}</span><br><span class="line"><span class="type">static</span> <span class="type">httpd_uri_t</span> device_uri = {</span><br><span class="line">            .uri = <span class="string">&quot;/device&quot;</span>,</span><br><span class="line">            .method = HTTP_GET,</span><br><span class="line">            .handler = device_handler</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x5173;&#x95ED;ap</span></span><br><span class="line"><span class="type">static</span> <span class="type">esp_err_t</span> <span class="title function_">closeap_handler</span><span class="params">(<span class="type">httpd_req_t</span> *req)</span></span><br><span class="line">{</span><br><span class="line">    wifi_close_ap();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// &#x663E;&#x793A;AP&#x5173;&#x95ED;&#x9875;&#x9762;</span></span><br><span class="line">    <span class="type">char</span> html_ap_off_temp[<span class="number">256</span>];</span><br><span class="line">    <span class="built_in">snprintf</span>(html_ap_off_temp, <span class="keyword">sizeof</span>(html_ap_off_temp), html_ap_off, sta_ip);</span><br><span class="line">    </span><br><span class="line">    <span class="type">size_t</span> len = <span class="built_in">strlen</span>(html_header) + <span class="built_in">strlen</span>(html_ap_off_temp) + <span class="built_in">strlen</span>(html_footer) + <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> *html_content = <span class="built_in">malloc</span>(len);</span><br><span class="line">    <span class="keyword">if</span> (html_content) {</span><br><span class="line">        <span class="built_in">snprintf</span>(html_content, len, <span class="string">&quot;%s%s%s&quot;</span>, html_header, html_ap_off_temp, html_footer);</span><br><span class="line">        httpd_resp_send(req, html_content, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">        <span class="built_in">free</span>(html_content);</span><br><span class="line">        <span class="keyword">return</span> ESP_OK;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    httpd_resp_send(req, <span class="string">&quot;AP&#x6A21;&#x5F0F;&#x5DF2;&#x5173;&#x95ED;&quot;</span>, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">    <span class="keyword">return</span> ESP_OK;</span><br><span class="line">}</span><br><span class="line"><span class="type">static</span> <span class="type">httpd_uri_t</span> closeap_uri = {</span><br><span class="line">            .uri = <span class="string">&quot;/closeap&quot;</span>,</span><br><span class="line">            .method = HTTP_GET,</span><br><span class="line">            .handler = closeap_handler</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// favicon.ico &#x5904;&#x7406;&#x51FD;&#x6570;</span></span><br><span class="line"><span class="type">static</span> <span class="type">esp_err_t</span> <span class="title function_">favicon_handler</span><span class="params">(<span class="type">httpd_req_t</span> *req)</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// &#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x7A7A;&#x54CD;&#x5E94;</span></span><br><span class="line">    httpd_resp_set_status(req, <span class="string">&quot;204 No Content&quot;</span>);</span><br><span class="line">    httpd_resp_send(req, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> ESP_OK;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// &#x6DFB;&#x52A0; favicon.ico &#x5904;&#x7406;</span></span><br><span class="line"><span class="type">static</span> <span class="type">httpd_uri_t</span> favicon_uri = {</span><br><span class="line">            .uri = <span class="string">&quot;/favicon.ico&quot;</span>,</span><br><span class="line">            .method = HTTP_GET,</span><br><span class="line">            .handler = favicon_handler</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x6307;&#x4EE4;&#x89E3;&#x6790;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x6362;&#x6210;&#x4F60;&#x9700;&#x8981;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6307;&#x4EE4;&#x89E3;&#x6790;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;</span></span><br><span class="line"><span class="type">static</span> <span class="type">esp_err_t</span> <span class="title function_">set_cmd_handler</span><span class="params">(<span class="type">httpd_req_t</span> *req)</span>{</span><br><span class="line">    <span class="type">char</span> html_control_temp[<span class="number">1024</span>];</span><br><span class="line">    <span class="built_in">snprintf</span>(html_control_temp, <span class="keyword">sizeof</span>(html_control_temp), html_control, sta_ip);</span><br><span class="line">    <span class="type">size_t</span> len = <span class="built_in">strlen</span>(html_header) + <span class="built_in">strlen</span>(html_control_temp) + <span class="built_in">strlen</span>(html_footer) + <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> *html_content = <span class="built_in">malloc</span>(len);</span><br><span class="line">    <span class="keyword">if</span> (html_content) {</span><br><span class="line">        <span class="built_in">snprintf</span>(html_content, len, <span class="string">&quot;%s%s%s&quot;</span>, html_header, html_control_temp, html_footer);</span><br><span class="line">        httpd_resp_send(req, html_content, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">        <span class="built_in">free</span>(html_content);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(command_parse_http_get(req-&gt;uri)!=<span class="number">0</span>){</span><br><span class="line">		httpd_resp_send_err(req, HTTPD_400_BAD_REQUEST, <span class="string">&quot;Invalid command&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ESP_OK;</span><br><span class="line">	}</span><br><span class="line">	httpd_resp_send(req, <span class="string">&quot;OK&quot;</span>, HTTPD_RESP_USE_STRLEN);</span><br><span class="line">    <span class="keyword">return</span> ESP_OK;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">httpd_uri_t</span> cmdControl_uri = {</span><br><span class="line">    .uri = <span class="string">&quot;/command&quot;</span>,</span><br><span class="line">    .method = HTTP_GET,</span><br><span class="line">    .handler = set_cmd_handler,</span><br><span class="line">    .user_ctx = <span class="literal">NULL</span>,</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">httpd_handle_t</span> <span class="title function_">start_webserver</span><span class="params">(<span class="type">void</span>)</span>{</span><br><span class="line">    <span class="comment">//&#x751F;&#x6210;&#x9ED8;&#x8BA4;http&#x914D;&#x7F6E;&#x53C2;&#x6570;</span></span><br><span class="line">    <span class="type">httpd_config_t</span> http_config = HTTPD_DEFAULT_CONFIG();</span><br><span class="line">    http_config.max_uri_handlers = <span class="number">8</span>;       <span class="comment">//&#x6700;&#x5927;uri&#x6570;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (httpd_start(&amp;server, &amp;http_config) == ESP_OK) {</span><br><span class="line">        <span class="comment">/* &#x6CE8;&#x518C; URI &#x5904;&#x7406;&#x7A0B;&#x5E8F; */</span></span><br><span class="line">        <span class="comment">// httpd_register_uri_handler(server, &amp;uri_get_status);</span></span><br><span class="line">        httpd_register_uri_handler(server, &amp;cmdControl_uri);</span><br><span class="line">        httpd_register_uri_handler(server, &amp;hello_world);</span><br><span class="line">        httpd_register_uri_handler(server, &amp;root_uri);</span><br><span class="line">        httpd_register_uri_handler(server, &amp;config_uri);</span><br><span class="line">        httpd_register_uri_handler(server, &amp;device_uri);</span><br><span class="line">        httpd_register_uri_handler(server, &amp;closeap_uri);</span><br><span class="line">        httpd_register_uri_handler(server, &amp;favicon_uri);</span><br><span class="line">        ESP_LOGI(TAG, <span class="string">&quot;Success starting server!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/* &#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x542F;&#x52A8;&#x5931;&#x8D25;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x53E5;&#x67C4;&#x662F; NULL */</span></span><br><span class="line">    ESP_LOGI(TAG, <span class="string">&quot;Error starting server!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">stop_webserver</span><span class="params">(<span class="type">void</span>)</span>{</span><br><span class="line">    <span class="keyword">if</span> (server) {</span><br><span class="line">        httpd_stop(server);</span><br><span class="line">        server = <span class="literal">NULL</span>;</span><br><span class="line">        ESP_LOGI(TAG, <span class="string">&quot;server stop&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="&#x7F51;&#x7EDC;&#x534F;&#x8BAE;"><a href="#&#x7F51;&#x7EDC;&#x534F;&#x8BAE;" class="headerlink" title="&#x7F51;&#x7EDC;&#x534F;&#x8BAE;"></a>&#x7F51;&#x7EDC;&#x534F;&#x8BAE;</h3><p>&#x8FD9;&#x5757;&#x7B14;&#x8005;&#x53EA;&#x662F;&#x7167;&#x732B;&#x753B;&#x864E;&#x52C9;&#x5F3A;&#x80FD;&#x7528;</p>
<p><a id="sectionHTTP&#x670D;&#x52A1;&#x5668;"></a></p>
<h4 id="HTTP-Server"><a href="#HTTP-Server" class="headerlink" title="HTTP_Server"></a>HTTP_Server</h4><p>HTTP &#x5DE5;&#x4F5C;&#x539F;&#x7406;<br>HTTP &#x534F;&#x8BAE;&#x5DE5;&#x4F5C;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;-&#x670D;&#x52A1;&#x7AEF;&#x67B6;&#x6784;&#x4E0A;&#x3002;</p>
<p>HTTP &#x5DE5;&#x4F5C;&#x8FC7;&#x7A0B;&#x901A;&#x5E38;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#xFF1A;&#x7528;&#x6237;&#x901A;&#x8FC7;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x5982;&#x6D4F;&#x89C8;&#x5668;&#xFF09;&#x8F93;&#x5165; URL&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x8D77;&#x4E00;&#x4E2A; HTTP &#x8BF7;&#x6C42;&#x3002;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#xFF1A;&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x6839;&#x636E;&#x8BF7;&#x6C42;&#x7684;&#x7C7B;&#x578B;&#xFF08;&#x5982;GET&#x3001;POST&#x7B49;&#xFF09;&#x548C;&#x8BF7;&#x6C42;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#x3002;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x54CD;&#x5E94;&#xFF1A;&#x670D;&#x52A1;&#x5668;&#x5C06;&#x5904;&#x7406;&#x7ED3;&#x679C;&#x5305;&#x88C5;&#x6210;HTTP&#x54CD;&#x5E94;&#x6D88;&#x606F;&#xFF0C;&#x53D1;&#x9001;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;&#x3002;<br>4.&#x5BA2;&#x6237;&#x7AEF;&#x6E32;&#x67D3;&#x9875;&#x9762;&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x54CD;&#x5E94;&#x540E;&#xFF0C;&#x6839;&#x636E;&#x54CD;&#x5E94;&#x5185;&#x5BB9;&#xFF08;&#x5982;HTML&#x3001;&#x56FE;&#x7247;&#x7B49;&#xFF09;&#x6E32;&#x67D3;&#x9875;&#x9762;&#xFF0C;&#x5C55;&#x793A;&#x7ED9;&#x7528;&#x6237;&#x3002;<br>Web &#x670D;&#x52A1;&#x5668;&#x6709;&#xFF1A;Nginx &#x670D;&#x52A1;&#x5668;&#xFF0C;Apache &#x670D;&#x52A1;&#x5668;&#xFF0C;IIS &#x670D;&#x52A1;&#x5668;&#xFF08;Internet Information Services&#xFF09;&#x7B49;&#x3002;</li>
</ol>
<p>HTTP &#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;&#x53F7;&#x4E3A; 80&#xFF0C;&#x4F46;&#x662F;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x6539;&#x4E3A; 8080 &#x6216;&#x8005;&#x5176;&#x4ED6;&#x7AEF;&#x53E3;&#x3002;</p>
<p>HTTP &#x4E09;&#x70B9;&#x6CE8;&#x610F;&#x4E8B;&#x9879;&#xFF1A;</p>
<ul>
<li><p>HTTP &#x662F;&#x65E0;&#x8FDE;&#x63A5;&#xFF1A;&#x65E0;&#x8FDE;&#x63A5;&#x7684;&#x542B;&#x4E49;&#x662F;&#x9650;&#x5236;&#x6BCF;&#x6B21;&#x8FDE;&#x63A5;&#x53EA;&#x5904;&#x7406;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5904;&#x7406;&#x5B8C;&#x5BA2;&#x6237;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7684;&#x5E94;&#x7B54;&#x540E;&#xFF0C;&#x5373;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#xFF0C;&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x8282;&#x7701;&#x4F20;&#x8F93;&#x65F6;&#x95F4;&#x3002;</p>
</li>
<li><p>HTTP &#x662F;&#x5A92;&#x4F53;&#x72EC;&#x7ACB;&#x7684;&#xFF1A;&#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x53EA;&#x8981;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x5904;&#x7406;&#x7684;&#x6570;&#x636E;&#x5185;&#x5BB9;&#xFF0C;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;HTTP&#x53D1;&#x9001;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x53CA;&#x670D;&#x52A1;&#x5668;&#x6307;&#x5B9A;&#x4F7F;&#x7528;&#x9002;&#x5408;&#x7684; MIME-type &#x5185;&#x5BB9;&#x7C7B;&#x578B;&#x3002;</p>
</li>
<li><p>HTTP &#x662F;&#x65E0;&#x72B6;&#x6001;&#xFF1A;HTTP &#x534F;&#x8BAE;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x534F;&#x8BAE;&#xFF0C;&#x65E0;&#x72B6;&#x6001;&#x662F;&#x6307;&#x534F;&#x8BAE;&#x5BF9;&#x4E8E;&#x4E8B;&#x52A1;&#x5904;&#x7406;&#x6CA1;&#x6709;&#x8BB0;&#x5FC6;&#x80FD;&#x529B;&#xFF0C;&#x7F3A;&#x5C11;&#x72B6;&#x6001;&#x610F;&#x5473;&#x7740;&#x5982;&#x679C;&#x540E;&#x7EED;&#x5904;&#x7406;&#x9700;&#x8981;&#x524D;&#x9762;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5219;&#x5B83;&#x5FC5;&#x987B;&#x91CD;&#x4F20;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x6BCF;&#x6B21;&#x8FDE;&#x63A5;&#x4F20;&#x9001;&#x7684;&#x6570;&#x636E;&#x91CF;&#x589E;&#x5927;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x9700;&#x8981;&#x5148;&#x524D;&#x4FE1;&#x606F;&#x65F6;&#x5B83;&#x7684;&#x5E94;&#x7B54;&#x5C31;&#x8F83;&#x5FEB;&#x3002;</p>
<blockquote>
<p><strong>&#x4EE5;&#x4E0A;&#x5185;&#x5BB9;&#x6458;&#x81EA;<a target="_blank" rel="noopener" href="https://www.runoob.com/http/http-intro.html">&#x83DC;&#x9E1F;&#x6559;&#x7A0B;</a></strong></p>
</blockquote>
</li>
</ul>
<h5 id="&#x53C2;&#x6570;&#x8BBE;&#x7F6E;-2"><a href="#&#x53C2;&#x6570;&#x8BBE;&#x7F6E;-2" class="headerlink" title="&#x53C2;&#x6570;&#x8BBE;&#x7F6E;"></a>&#x53C2;&#x6570;&#x8BBE;&#x7F6E;</h5><ul>
<li>&#x542F;&#x52A8;http&#x670D;&#x52A1;&#x5668;<code>httpd_start(httpd_handle_t *handle, const httpd_config_t *config)</code><br>  <code>httpd_start(&amp;server, &amp;http_config)</code><ul>
<li><strong>httpd_config_t http_config</strong> = HTTPD_DEFAULT_CONFIG();    //&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;</li>
<li><strong>http_config.max_uri_handlers</strong> = 8;       //&#x6700;&#x5927;uri&#x6570;</li>
<li><strong>static httpd_handle_t server</strong> = NULL;    //&#x7F6E;&#x7A7A;esp_http_server&#x5B9E;&#x4F8B;&#x7684;&#x53E5;&#x67C4;&#xFF0C;&#x9632;&#x6B62;&#x91CD;&#x590D;&#x542F;&#x52A8;HTTP&#x670D;&#x52A1;</li>
</ul>
</li>
<li>&#x5F53;http&#x670D;&#x52A1;&#x542F;&#x52A8;&#x6210;&#x529F;&#x540E;&#x9700;&#x8981;&#x6CE8;&#x518C;uri&#x5904;&#x7406;&#x51FD;&#x6570;<code>httpd_register_uri_handler(httpd_handle_t handle,const httpd_uri_t *uri_handler)</code><br> <code>httpd_register_uri_handler(server, &amp;hello_world);</code><ul>
<li><strong>static httpd_handle_t server</strong> = NULL;    //&#x7F6E;&#x7A7A;esp_http_server&#x5B9E;&#x4F8B;&#x7684;&#x53E5;&#x67C4;&#xFF0C;&#x9632;&#x6B62;&#x91CD;&#x590D;&#x542F;&#x52A8;HTTP&#x670D;&#x52A1;</li>
<li><strong>&amp;hello_world</strong> &#x6307;&#x5411;uri&#x5904;&#x7406;&#x51FD;&#x6570;&#x4E2D;&#x9700;&#x8981;&#x7684;&#x4FE1;&#x606F;&#x7ED3;&#x6784;&#x4F53;&#xFF1A;     <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">httpd_uri_t</span> hello_world = {</span><br><span class="line">    .uri = <span class="string">&quot;/helloworld&quot;</span>,           <span class="comment">//uri</span></span><br><span class="line">    .method = HTTP_GET,             <span class="comment">//&#x65B9;&#x6CD5;</span></span><br><span class="line">    .handler = hello_world_handler, <span class="comment">//&#x4E0A;&#x4E0B;&#x6587;&#x6570;&#x636E;</span></span><br><span class="line">    .user_ctx = <span class="string">&quot;Hello World!&quot;</span>,     <span class="comment">//&#x7528;&#x6237;&#x7684;&#x4E0A;&#x4E0B;&#x6587;</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>&#x505C;&#x6B62;http&#x670D;&#x52A1;&#x5668;<code>httpd_stop(httpd_handle_t handle)</code><br>  <code>httpd_stop(server);</code><ul>
<li><strong>static httpd_handle_t server</strong> = NULL;    //&#x7F6E;&#x7A7A;esp_http_server&#x5B9E;&#x4F8B;&#x7684;&#x53E5;&#x67C4;&#xFF0C;&#x9632;&#x6B62;&#x91CD;&#x590D;&#x542F;&#x52A8;HTTP&#x670D;&#x52A1;</li>
</ul>
</li>
</ul>
<h5 id="&#x5B9E;&#x6218;-3"><a href="#&#x5B9E;&#x6218;-3" class="headerlink" title="&#x5B9E;&#x6218;"></a>&#x5B9E;&#x6218;</h5><p>&#x4EE5;&#x8BF7;&#x6C42;hello world&#x4E3A;&#x4F8B;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//http_server.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _HTTP_SERVER_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _HTTP_SERVER_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_http_server.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> {</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">httpd_handle_t</span> <span class="title function_">start_webserver</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">stop_webserver</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//http_server.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_check.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;http_server.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cmd_parser.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;wifi_driver.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIN(x, y) ((x) &lt; (y) ? (x) : (y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_HTTP_QUERY_KEY_MAX_LEN  (64)</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *TAG = <span class="string">&quot;HTTP&quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">httpd_handle_t</span> server = <span class="literal">NULL</span>;        <span class="comment">//&#x7F6E;&#x7A7A;esp_http_server&#x5B9E;&#x4F8B;&#x7684;&#x53E5;&#x67C4;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* URI &#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77; GET /helloworld &#x8BF7;&#x6C42;&#x65F6;&#x88AB;&#x8C03;&#x7528; */</span></span><br><span class="line"><span class="comment">/* An HTTP GET handler */</span></span><br><span class="line"><span class="type">static</span> <span class="type">esp_err_t</span> <span class="title function_">hello_world_handler</span><span class="params">(<span class="type">httpd_req_t</span> *req)</span></span><br><span class="line">{</span><br><span class="line">	<span class="type">char</span> *buf;</span><br><span class="line">	<span class="type">size_t</span> buf_len;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Get header value string length and allocate memory for length + 1,</span></span><br><span class="line"><span class="comment">	 * extra byte for null termination */</span></span><br><span class="line">	buf_len = httpd_req_get_hdr_value_len(req, <span class="string">&quot;Host&quot;</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (buf_len &gt; <span class="number">1</span>)</span><br><span class="line">	{</span><br><span class="line">		buf = <span class="built_in">malloc</span>(buf_len);</span><br><span class="line">		ESP_RETURN_ON_FALSE(buf, ESP_ERR_NO_MEM, TAG, <span class="string">&quot;buffer alloc failed&quot;</span>);</span><br><span class="line">		<span class="comment">/* Copy null terminated value string into buffer */</span></span><br><span class="line">		<span class="keyword">if</span> (httpd_req_get_hdr_value_str(req, <span class="string">&quot;Host&quot;</span>, buf, buf_len) == ESP_OK)</span><br><span class="line">		{</span><br><span class="line">			ESP_LOGI(TAG, <span class="string">&quot;Found header =&gt; Host: %s&quot;</span>, buf);</span><br><span class="line">		}</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	buf_len = httpd_req_get_hdr_value_len(req, <span class="string">&quot;Test-Header-2&quot;</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (buf_len &gt; <span class="number">1</span>)</span><br><span class="line">	{</span><br><span class="line">		buf = <span class="built_in">malloc</span>(buf_len);</span><br><span class="line">		ESP_RETURN_ON_FALSE(buf, ESP_ERR_NO_MEM, TAG, <span class="string">&quot;buffer alloc failed&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (httpd_req_get_hdr_value_str(req, <span class="string">&quot;Test-Header-2&quot;</span>, buf, buf_len) == ESP_OK)</span><br><span class="line">		{</span><br><span class="line">			ESP_LOGI(TAG, <span class="string">&quot;Found header =&gt; Test-Header-2: %s&quot;</span>, buf);</span><br><span class="line">		}</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	buf_len = httpd_req_get_hdr_value_len(req, <span class="string">&quot;Test-Header-1&quot;</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (buf_len &gt; <span class="number">1</span>)</span><br><span class="line">	{</span><br><span class="line">		buf = <span class="built_in">malloc</span>(buf_len);</span><br><span class="line">		ESP_RETURN_ON_FALSE(buf, ESP_ERR_NO_MEM, TAG, <span class="string">&quot;buffer alloc failed&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (httpd_req_get_hdr_value_str(req, <span class="string">&quot;Test-Header-1&quot;</span>, buf, buf_len) == ESP_OK)</span><br><span class="line">		{</span><br><span class="line">			ESP_LOGI(TAG, <span class="string">&quot;Found header =&gt; Test-Header-1: %s&quot;</span>, buf);</span><br><span class="line">		}</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Set some custom headers */</span></span><br><span class="line">	<span class="comment">//&#x8BBE;&#x7F6E;&#x81EA;&#x5B9A;&#x4E49;&#x5934;</span></span><br><span class="line">	httpd_resp_set_hdr(req, <span class="string">&quot;Custom-Header-1&quot;</span>, <span class="string">&quot;Custom-Value-1&quot;</span>);</span><br><span class="line">	httpd_resp_set_hdr(req, <span class="string">&quot;Custom-Header-2&quot;</span>, <span class="string">&quot;Custom-Value-2&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Send response with custom headers and body set as the</span></span><br><span class="line"><span class="comment">	 * string passed in user context*/</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *resp_str = (<span class="type">const</span> <span class="type">char</span> *)req-&gt;user_ctx;		</span><br><span class="line">	httpd_resp_send(req, resp_str, HTTPD_RESP_USE_STRLEN);	<span class="comment">//&#x53D1;&#x9001;resp_str&#x5B57;&#x7B26;&#x4E32;&#x5185;&#x5BB9;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* After sending the HTTP response the old HTTP request</span></span><br><span class="line"><span class="comment">	 * headers are lost. Check if HTTP request headers can be read now. */</span></span><br><span class="line">	<span class="comment">//&#x54CD;&#x5E94;http&#x65E7;&#x8BF7;&#x6C42;&#x540E;&#x68C0;&#x67E5;</span></span><br><span class="line">	<span class="keyword">if</span> (httpd_req_get_hdr_value_len(req, <span class="string">&quot;Host&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">		ESP_LOGI(TAG, <span class="string">&quot;Request headers lost&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ESP_OK;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//uri&#x914D;&#x7F6E;&#x4FE1;&#x606F;</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">httpd_uri_t</span> hello_world = {</span><br><span class="line">    .uri = <span class="string">&quot;/helloworld&quot;</span>,</span><br><span class="line">    .method = HTTP_GET,</span><br><span class="line">    .handler = hello_world_handler,</span><br><span class="line">    .user_ctx = <span class="string">&quot;Hello World!&quot;</span>,</span><br><span class="line">};</span><br><span class="line"><span class="comment">//&#x542F;&#x52A8;http&#x670D;&#x52A1;</span></span><br><span class="line"><span class="type">httpd_handle_t</span> <span class="title function_">start_webserver</span><span class="params">(<span class="type">void</span>)</span>{</span><br><span class="line">    <span class="comment">//&#x751F;&#x6210;&#x9ED8;&#x8BA4;http&#x914D;&#x7F6E;&#x53C2;&#x6570;</span></span><br><span class="line">    <span class="type">httpd_config_t</span> http_config = HTTPD_DEFAULT_CONFIG();</span><br><span class="line">    http_config.max_uri_handlers = <span class="number">8</span>;       <span class="comment">//&#x6700;&#x5927;uri&#x6570;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (httpd_start(&amp;server, &amp;http_config) == ESP_OK) {</span><br><span class="line">        <span class="comment">/* &#x6CE8;&#x518C; URI &#x5904;&#x7406;&#x7A0B;&#x5E8F; */</span></span><br><span class="line">        httpd_register_uri_handler(server, &amp;hello_world);</span><br><span class="line">        ESP_LOGI(TAG, <span class="string">&quot;Success starting server!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/* &#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x542F;&#x52A8;&#x5931;&#x8D25;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x53E5;&#x67C4;&#x662F; NULL */</span></span><br><span class="line">    ESP_LOGI(TAG, <span class="string">&quot;Error starting server!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//&#x505C;&#x6B62;http&#x670D;&#x52A1;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">stop_webserver</span><span class="params">(<span class="type">void</span>)</span>{</span><br><span class="line">    <span class="keyword">if</span> (server) {</span><br><span class="line">        httpd_stop(server);</span><br><span class="line">        server = <span class="literal">NULL</span>;</span><br><span class="line">        ESP_LOGI(TAG, <span class="string">&quot;server stop&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag"># 笔记</a>
              <a href="/tags/ESP32/" rel="tag"># ESP32</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/08/13/stm32h750%E6%B7%BB%E5%8A%A0QRencode%E5%BA%93%EF%BC%8C%E4%BB%A5zabr%E5%92%8Cquirc%E4%B8%BA%E4%BE%8B/" rel="prev" title="stm32h750添加QRencode库，以zabr和quirc为例">
                  <i class="fa fa-angle-left"></i> stm32h750添加QRencode库，以zabr和quirc为例
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">RZJZWD</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
